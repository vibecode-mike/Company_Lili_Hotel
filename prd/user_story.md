# 力麗飯店 LineOA CRM 管理後台 - 使用者故事文檔

**文檔版本**: v1.0
**最後更新**: 2025-10-15
**對應 PRD**: v1.1
**實施狀態**: v0.1 開發中

---

## 目錄

- [模組一：LineOA CRM 管理後台](#模組一lineoa-crm-管理後台)
- [模組二：活動與訊息推播](#模組二活動與訊息推播)
- [模組三：PMS 串接模組](#模組三pms-串接模組)
- [模組四：標籤追蹤與數據分析](#模組四標籤追蹤與數據分析)
- [模組五：帳號與授權登入](#模組五帳號與授權登入)
- [模組六：會員管理](#模組六會員管理)
- [模組七：問卷模板](#模組七問卷模板)

---

## 模組一：LineOA CRM 管理後台

### 使用者故事

| 編號 | 名稱 | 優先級 | 實施狀態 |
|------|------|--------|---------|
| S_CRM_001 | 新增會員資料 | P0 | ✅ 已實施 |
| S_CRM_002 | 會員資料管理 | P0 | ✅ 已實施 |
| S_CRM_003 | 標籤管理 | P0 | ✅ 已實施 |
| S_CRM_004 | 客戶搜尋與篩選 | P1 | ✅ 已實施 |

---

#### S_CRM_001：新增會員資料

**Story**
作為一位客服人員，我希望能夠手動新增會員資料（包含電子信箱、行動電話、姓名、性別、身分證/護照號碼），以便在會員尚未透過 LINE 官方帳號加入時，也能建立完整的會員檔案進行後續管理。

**驗收標準（AC）**

- ✅ 使用者可以透過後台介面新增會員
- ✅ 必填欄位包含：姓名（姓、名）、行動電話、身分證/護照號碼（唯一值）
- ✅ 選填欄位包含：電子信箱、性別
- ✅ 系統驗證身分證/護照號碼的唯一性，不允許重複
- ✅ 系統驗證電子信箱格式正確性
- ✅ 系統驗證行動電話格式正確性
- ✅ 新增成功後，系統自動記錄建立時間與來源（後台系統）
- ✅ 新增成功後，顯示成功提示訊息並返回會員清單
- ✅ 若驗證失敗，顯示明確的錯誤訊息並保留已輸入的資料

**技術備註**
- 資料儲存於 MySQL 資料庫
- 需實作欄位驗證邏輯（前端 + 後端雙重驗證）
- 建立時間自動產生（系統時間）

**依賴關係**
- 無

---

#### S_CRM_002：會員資料管理

**Story**
作為一位客服人員，我希望能夠查看、修改和刪除會員資料，並與德安 PMS 系統同步相關資訊（觸發標籤、個人資料、住宿紀錄、是否接收優惠通知），以便維護會員資料的正確性和完整性。

**驗收標準（AC）**

- ✅ 使用者可以查看會員詳細資料，包含：
  - LINE 會員頭像 + 名稱、姓名、性別、生日、電子信箱、手機號碼、身分證/護照號碼
  - 加入來源（LINE / CRM / 系統）、建立時間、最後互動日期、LINE UID
  - 會員標籤、活動標籤
- ⚠️ 使用者可以修改會員資料（除了唯一識別碼：身分證/護照號碼）
- ⚠️ 使用者可以刪除會員資料（需二次確認，防止誤刪）
- ❌ 若與 PMS 系統整合（v0.2），修改後的資料可選擇性同步至 PMS
- ✅ 修改成功後，系統自動記錄最後修改時間
- ✅ 系統顯示會員的住宿紀錄資訊（住宿日期、房型）
- ✅ 使用者可以設定會員是否接收優惠通知（開關按鈕）
- ✅ 所有修改操作需記錄操作日誌（操作人、操作時間、修改內容）

**技術備註**
- v0.1 暫未實施 PMS 串接，改為獨立會員管理
- v0.2 將實施 PMS 雙向同步功能
- 刪除操作建議使用軟刪除（標記為已刪除，而非實際刪除記錄）

**依賴關係**
- S_CRM_001：需先有新增會員功能
- S_PMS_001：未來版本依賴 PMS 串接功能

---

#### S_CRM_003：標籤管理

**Story**
作為一位行銷人員，我希望能夠管理基礎會員標籤（如生日、年齡、地區、性別）和活動標籤（如點擊圖文訊息的互動紀錄），並支援為會員批次新增或刪除標籤，以便進行精準的客群分眾管理。

**驗收標準（AC）**

- ✅ 系統支援兩種標籤類型：
  - 會員標籤：基於會員基本屬性（生日、年齡、地區、性別、會員等級等）
  - 活動標籤：基於會員互動行為（點擊圖文訊息、圖文選單、廣告互動等）
- ✅ 使用者可以新增自訂標籤（輸入標籤名稱、選擇標籤類型）
- ✅ 使用者可以查看所有已建立的標籤清單
- ✅ 使用者可以編輯標籤名稱（修改後自動更新所有使用該標籤的會員）
- ✅ 使用者可以刪除標籤（需二次確認，顯示受影響的會員數量）
- ✅ 使用者可以為單一會員新增或刪除標籤
- ⚠️ 使用者可以批次為多位會員新增或刪除標籤（v0.2）
- ✅ 系統自動記錄標籤的建立時間、建立人、使用次數
- ✅ 標籤管理介面顯示每個標籤的使用人數統計

**技術備註**
- 標籤與會員為多對多關係（需建立關聯表）
- 活動標籤由系統自動產生（會員點擊互動時觸發）
- 會員標籤可手動建立或從 API 同步

**依賴關係**
- S_CRM_002：需先有會員資料管理功能
- S_PM_002：活動標籤需與訊息圖文模板整合

---

#### S_CRM_004：客戶搜尋與篩選

**Story**
作為一位客服人員，我希望能夠透過多種條件（標籤、日期時間、住宿紀錄、互動行為）快速搜尋和篩選會員，以便精準找到目標客群進行後續行銷或客服操作。

**驗收標準（AC）**

- ✅ 支援模糊搜尋：LINE 名稱、姓名、電子信箱、手機號碼
- ✅ 支援精準篩選：
  - 會員標籤（多選，支援包含或排除邏輯）
  - 活動標籤（多選，支援包含或排除邏輯）
  - 性別（單選）
  - 建立來源（LINE 官方帳號 / CRM / 後台系統）
  - 建立時間範圍（起始日期～結束日期）
  - 最後互動時間範圍（起始日期～結束日期）
- ✅ 支援排序功能：
  - 依建立時間排序（最新/最舊）
  - 依最後互動時間排序（最近/最久）
- ⚠️ 支援依住宿紀錄篩選：住宿日期範圍、房型（v0.2，需 PMS 串接）
- ✅ 搜尋結果顯示符合條件的會員數量
- ✅ 搜尋結果支援分頁顯示（每頁 20 筆）
- ✅ 使用者可以儲存常用的篩選條件為「快速篩選」（v0.2）
- ✅ 系統顯示目前套用的篩選條件，可快速清除

**技術備註**
- 使用複合索引優化查詢效能（標籤、建立時間、最後互動時間）
- 搜尋結果快取機制（提升重複查詢效能）
- 分頁查詢避免一次載入過多資料

**依賴關係**
- S_CRM_002：需先有會員資料管理功能
- S_CRM_003：需先有標籤管理功能
- S_PMS_002：住宿紀錄篩選需依賴 PMS 資料同步

---

## 模組二：活動與訊息推播

### 使用者故事

| 編號 | 名稱 | 優先級 | 實施狀態 |
|------|------|--------|---------|
| S_PM_001 | 建立訊息推播 | P0 | ✅ 已實施 |
| S_PM_002 | 訊息圖文模板 | P0 | ✅ 已實施 |
| S_PM_003 | 訊息數據成效 | P1 | ✅ 已實施 |
| S_PM_004 | 自動回應 v0.3 | P1 | ✅ 已實施 |

---

#### S_PM_001：建立訊息推播

**Story**
作為一位行銷人員，我希望建立訊息並支援排程推播，同時能夠精準鎖定目標受眾並提前預估發送配額，以便高效部署和管理我的品牌行銷活動。

**驗收標準（AC）**

- ✅ 使用者可以從已建立的訊息圖文模板中選擇並建立群發訊息
- ✅ 訊息發送之前，支援訊息效果的即時模擬與預覽功能
- ✅ 必須能夠選擇以下任一傳送對象：
  - 所有好友
  - 篩選目標對象（依據基礎會員標籤進行篩選，並支援包含或排除指定條件的組合邏輯）
- ✅ 使用者能夠選擇立即傳送，或於指定發送日期（YYYY/MM/DD）與發送時間（HH:MM）進行排程傳送
- ✅ 使用者可選擇訊息特定的觸發條件，如：加入好友期間的 7～29 天
- ✅ 在確認發送前，系統必須顯示此次訊息的預計發送好友人數、即當前可用訊息的配額用量
- ✅ 若可用訊息的配額用量 < 預計發送的好友人數，系統須阻擋發送行為，並向使用者顯示明確的提示
- ✅ 當編輯到一半，離開視窗則彈窗提示
- ✅ 可以將未完成設定的群發訊息儲存為草稿，並支援隨時可開啟編輯

**技術備註**
- 整合 LINE Messaging API 進行訊息推播
- 排程功能需實作任務排程器（如 Celery 或 APScheduler）
- 配額查詢透過 LINE API 取得當前可用配額
- 草稿儲存於資料庫，狀態標記為 "draft"

**依賴關係**
- S_PM_002：需先有訊息圖文模板功能
- S_CRM_003：需先有標籤管理功能（用於篩選對象）

---

#### S_PM_002：訊息圖文模板

**Story**
作為一位內容管理者，我希望有一套靈活的機制來建立多媒體、高互動性的訊息模板，維持用戶對品牌的新鮮感與參與度，以利蒐集更多用戶的行為數據。

**驗收標準（AC）**

**支援 3 種訊息圖文模板類型**（v0.1 實施版本）：

| 類型 | 類型名稱 | 核心組成 | 互動性 | 實施狀態 |
|------|---------|---------|--------|---------|
| Template01 | 文字按鈕確認型 | 文字* / 按鈕（最多2個） | 有 | ✅ 已實施 |
| Template02 | 圖卡按鈕型 | 圖片* / 標題 / 內文 / 按鈕 | 有 | ✅ 已實施 |
| Template03 | 圖片點擊型 | 圖片* / 按鈕 | 有 | ✅ 已實施 |

**頁面佈局設計**（v0.1 實施版本）：
- ✅ **左側區域**：表單輸入區，包含模板類型選擇、圖片上傳、動作按鈕設定、互動類型設定、發送設定等
- ✅ **右側區域**：即時預覽區，使用手機模擬器樣式展示訊息效果

**模板功能要求**：

- ✅ 適用於圖片點擊型、圖卡按鈕型模板：支援多張輪播圖卡，每個輪播圖可獨立設定圖片、動作按鈕、互動標籤
- ✅ 適用於圖片點擊型模板：圖片為必填、可選擇圖面下方是否顯示動作按鈕，且可調整按鈕文字、每張輪播圖可設定用於數據追蹤的互動標籤，以及用戶點擊此圖卡後觸發的互動結果
- ✅ 適用於圖卡按鈕型模板：圖片與標題為必填、可選填內文描述、並可選擇顯示的文字按鈕數量（1個）、每張輪播圖卡可設定用於數據追蹤的互動標籤，以及用戶點擊此圖卡後觸發的互動結果
- ✅ 所有涉及圖片的模板皆可上傳圖片，圖片格式支援 JPG、JPEG、PNG，檔案大小支援 1 MB 以下，可重新上傳
- ✅ 每個模板可設定用於數據追蹤的互動標籤，標籤為選填
- ✅ 每個模板可設定用戶點擊此圖卡後觸發的互動結果，必填。當用戶點擊後觸發的動作類型如：無互動、開啟網址連結、觸發新訊息（須定義訊息文字）、觸發新圖片（須上傳圖片檔案）
- ✅ 適用於文字按鈕確認型、圖片點擊型、圖卡按鈕型模板：須設定通知訊息，為用戶透過手機 LINE APP 推播時會收到的簡短通知內容
- ✅ 適用於文字按鈕確認型、圖片點擊型、圖卡按鈕型模板：須設定訊息預覽，為用戶在尚未進入對話窗前看到的訊息內容，通常顯示為訊息的最後一行

**v0.1 簡化說明**：
- 圖卡按鈕型：不支援金額欄位、按鈕數量固定為 1 個
- 輪播功能：支援新增多個輪播圖，支援前後導航和直接選擇頁碼
- 圖片處理：暫未實施自動 Fill 填滿處理，將在 v0.2 優化

**技術備註**
- 整合 LINE Messaging API 的 Flex Message 功能
- 圖片上傳需實作檔案大小與格式驗證
- 互動標籤觸發需記錄於資料庫（用於後續數據分析）
- 即時預覽使用 LINE Flex Message Simulator

**依賴關係**
- S_CRM_003：需先有標籤管理功能（用於設定互動標籤）

---

#### S_PM_003：訊息數據成效

**Story**
作為一位行銷數據人員，我希望系統存取所有已發訊息的歷史成效數據，以利分析用戶對內容與互動的偏好,來為下個季度做行銷的優化與調整。

**驗收標準（AC）**

- ✅ 以清單形式顯示訊息發送清單：
  - 縮圖（若無圖片則為系統預設圖）
  - 傳送時間
  - 傳送人數
  - 部分訊息內容
  - 開啟次數（訊息被打開已讀的不重複次數）
  - 點擊次數（訊息中觸發互動按鈕、連結的不重複次數）
- ✅ 系統須識別訊息的 4 種發送狀態，並依據狀態附帶其可編輯性：
  - 排程發送（可編輯）
  - 已發送（不可編輯）
  - 草稿（可編輯）
  - 發送失敗（顯示失敗原因：訊息額度不足）
- ✅ 支援依據訊息的傳送時間進行篩選，允許帶入起始時間或結束時間來搜索歷史訊息
- ✅ 當點擊任一訊息後，進入查看詳細頁面，如：
  - 廣告成效趨勢圖（折線圖）
  - 可檢視發送對象的清單
  - 完整的訊息內容

**技術備註**
- 整合 LINE Messaging API 的訊息追蹤功能
- 開啟次數、點擊次數需透過 Webhook 接收並記錄
- 成效趨勢圖使用圖表庫（如 Chart.js 或 ECharts）
- 資料儲存於資料庫並定期同步 LINE API 數據

**依賴關係**
- S_PM_001：需先有建立訊息推播功能
- S_PM_002：需先有訊息圖文模板功能

---

#### S_PM_004：自動回應 v0.3

**Story**
作為一位使用者，我希望設定歡迎訊息，當用戶加入本帳號好友時自動觸發，以利在第一時間與用戶互動不疏漏，且可蒐集用戶資訊支持 CRM（會員資料整合）。

**驗收標準（AC）**

- ✅ 支援事先設定訊息回應內容，被觸發有 3 種方式：
  1. 新好友歡迎訊息
  2. 輸入關鍵字觸發
  3. 選擇指定時間觸發
- ✅ 選擇新好友歡迎訊息，可設定訊息觸發訊息
- ✅ 選擇關鍵字觸發訊息，可輸入多組關鍵字（最多 20 組），收到用戶與任一關鍵字相配時進行回覆，觸發到的關鍵字會記錄於後台
- ✅ 選擇指定時間觸發，可選擇指定日期區間或時間區間（例：非營業時間觸發）
- ✅ 訊息回應格式以純文字為主，未來可選擇插入訊息圖文模板，或是上傳圖片檔案
- ✅ 設定自動回應訊息至少 1 筆（最多 5 筆），可以新增或刪除
- ✅ 支援發送前的效果即時預覽
- ✅ 設定完成，可將該訊息內容選擇停用或刪除，停用則不會啟動觸發，刪除則無法復原須重新設定
- ✅ 設定完成，可編輯該訊息內容，於用戶下次更新即觸發更新後的內容
- ✅ 於訊息外部可以查看訊息的停用與啟用狀態、回應的類型（如：歡迎訊息 / 關鍵字 / 指定時間）

**技術備註**
- 整合 LINE Messaging API 的 Webhook 接收訊息事件
- 關鍵字比對使用模糊匹配演算法
- 時間觸發使用排程器檢查當前時間是否在設定區間
- 自動回應記錄儲存於資料庫並記錄觸發日誌

**依賴關係**
- S_PM_002：未來版本可選擇插入訊息圖文模板

---

## 模組三：PMS 串接模組

### 使用者故事

| 編號 | 名稱 | 優先級 | 實施狀態 |
|------|------|--------|---------|
| S_PMS_001 | PMS 客戶資料同步 | P1 | ❌ 未實施 (v0.2) |
| S_PMS_002 | PMS 住宿紀錄同步 | P1 | ❌ 未實施 (v0.2) |
| S_PMS_003 | PMS 資料比對機制 | P1 | ❌ 未實施 (v0.2) |

**實施狀態說明**：v0.1 版本暫未實施 PMS 串接，改為獨立會員管理系統。以下使用者故事規劃用於 v0.2 版本實施。

---

#### S_PMS_001：PMS 客戶資料同步

**Story**
作為一位飯店管理者，我希望系統能夠自動與德安 PMS 系統同步客戶資料（包含電子信箱、行動電話、姓名、性別、身分證/護照號碼、是否接收優惠通知），以便確保 CRM 系統與 PMS 系統的會員資料保持一致，減少人工重複輸入的負擔。

**驗收標準（AC）**

- ❌ 系統支援與德安 PMS 系統的 API 串接
- ❌ 系統可設定自動同步時間（如：每日凌晨 2:00）
- ❌ 系統可手動觸發立即同步
- ❌ 同步範圍包含以下欄位：
  - 電子信箱
  - 行動電話
  - 姓（中文/英文）
  - 名（中文/英文）
  - 性別
  - 身分證/護照號碼（唯一識別碼）
  - 是否接收優惠通知
- ❌ 同步邏輯：
  - 若會員不存在，自動建立新會員（來源標記為 "PMS"）
  - 若會員已存在（依身分證/護照號碼比對），更新會員資料
  - 若 PMS 資料與 CRM 資料衝突，以 PMS 為準並記錄衝突日誌
- ❌ 同步完成後，系統生成同步報告（新增筆數、更新筆數、失敗筆數）
- ❌ 若同步失敗，系統發送通知給管理員並記錄錯誤日誌

**技術備註**
- 需與德安 PMS 系統確認 API 規格與認證方式
- 使用排程器（如 Celery）定期執行同步任務
- 資料比對使用身分證/護照號碼作為唯一識別碼
- 衝突日誌需記錄：同步時間、欄位名稱、PMS 值、CRM 值

**依賴關係**
- S_CRM_001：需先有新增會員功能
- S_CRM_002：需先有會員資料管理功能

---

#### S_PMS_002：PMS 住宿紀錄同步

**Story**
作為一位行銷人員，我希望系統能夠自動與德安 PMS 系統同步會員的住宿紀錄（包含入住日期、退房日期、房型、住宿金額），以便根據會員的住宿歷史進行精準行銷（如：推送續住優惠、房型升等優惠）。

**驗收標準（AC）**

- ❌ 系統支援與德安 PMS 系統同步住宿紀錄
- ❌ 同步範圍包含以下欄位：
  - 訂單編號（PMS 系統唯一識別碼）
  - 入住日期
  - 退房日期
  - 房型名稱
  - 住宿天數
  - 住宿金額
  - 訂單狀態（已完成/已取消/未入住）
- ❌ 系統自動計算會員的消費統計：
  - 總消費金額
  - 總住宿次數
  - 最近一次住宿日期
  - 最常入住的房型
  - 平均每次消費金額
- ❌ 系統根據住宿頻率自動標記會員等級（如：VIP 會員、一般會員）
- ❌ 住宿紀錄可在會員詳細資料頁面查看（列表形式，支援排序與篩選）
- ❌ 若同步失敗，系統記錄錯誤日誌並通知管理員

**技術備註**
- 住宿紀錄與會員資料為一對多關係
- 消費統計使用聚合查詢（SUM、COUNT、AVG）
- 會員等級計算邏輯可設定閾值（如：年度消費 ≥ 10 萬 = VIP）
- 住宿紀錄需定期同步（建議每日一次）

**依賴關係**
- S_PMS_001：需先有 PMS 客戶資料同步功能
- S_CRM_002：需先有會員資料管理功能

---

#### S_PMS_003：PMS 資料比對機制

**Story**
作為一位系統管理員，我希望系統能夠提供完善的資料比對機制（以身分證字號/手機號碼作關聯），並定期檢查資料一致性，以便確保 CRM 系統與 PMS 系統的資料保持同步，避免資料不一致導致的行銷錯誤。

**驗收標準（AC）**

- ❌ 系統支援兩種比對方式：
  - 主要比對：身分證/護照號碼（唯一識別碼）
  - 次要比對：手機號碼（若身分證/護照號碼無法比對）
- ❌ 若同一身分證/護照號碼在 PMS 與 CRM 中有多筆資料，系統標記為「重複資料」並通知管理員
- ❌ 若 PMS 資料與 CRM 資料衝突（如：同一身分證但姓名不同），系統記錄衝突日誌並提供手動合併介面
- ❌ 系統提供「資料一致性檢查」功能，可手動觸發或排程執行（建議每週一次）
- ❌ 檢查報告包含：
  - 一致資料筆數
  - 衝突資料筆數（列出衝突欄位）
  - 遺失資料筆數（PMS 有但 CRM 無）
  - 孤立資料筆數（CRM 有但 PMS 無）
- ❌ 管理員可選擇批次處理衝突資料（如：全部以 PMS 為準、全部保留 CRM）
- ❌ 所有比對與合併操作需記錄操作日誌（操作人、操作時間、處理方式）

**技術備註**
- 比對演算法需考慮效能（使用索引優化查詢）
- 衝突日誌需記錄完整的欄位差異（JSON 格式儲存）
- 手動合併介面提供並排比對檢視（PMS vs CRM）
- 定期檢查使用排程器（如 Celery）執行

**依賴關係**
- S_PMS_001：需先有 PMS 客戶資料同步功能
- S_PMS_002：需先有 PMS 住宿紀錄同步功能

---

## 模組四：標籤追蹤與數據分析

### 使用者故事

| 編號 | 名稱 | 優先級 | 實施狀態 |
|------|------|--------|---------|
| S_DA_001 | 點擊標籤追蹤 | P0 | ✅ 已實施 |
| S_DA_002 | 標籤觸發儀表板 | P1 | ⚠️ 部分實施 |
| S_DA_003 | 行銷活動 KPI 分析 | P1 | ⚠️ 部分實施 |
| S_DA_004 | 報表匯出 | P2 | ❌ 未實施 (v0.2) |

---

#### S_DA_001：點擊標籤追蹤

**Story**
作為一位行銷數據人員，我希望系統能夠自動追蹤會員點擊訊息中的互動按鈕或連結時觸發的標籤，並記錄觸發次數與人數，以便了解哪些活動或內容最受會員歡迎，作為後續行銷策略的依據。

**驗收標準（AC）**

- ✅ 當會員點擊訊息中的互動按鈕或連結時，系統自動記錄以下資訊：
  - 會員 UID（LINE 唯一識別碼）
  - 觸發的標籤名稱
  - 觸發時間（精確到秒）
  - 觸發來源（訊息 ID、活動 ID）
  - 觸發動作類型（點擊按鈕、點擊圖片、點擊連結）
- ✅ 系統支援同一會員多次觸發同一標籤（記錄所有觸發記錄）
- ✅ 系統自動計算每個標籤的統計數據：
  - 總觸發次數（包含重複觸發）
  - 觸發人數（不重複會員數）
  - 觸發率（觸發人數 / 訊息發送人數）
- ✅ 標籤觸發記錄可在會員詳細資料頁面查看（列表形式，包含觸發時間、標籤名稱、來源活動）
- ✅ 系統提供「標籤觸發明細」查詢功能，可依標籤名稱、時間範圍篩選

**技術備註**
- 整合 LINE Messaging API 的 Webhook 接收點擊事件
- 觸發記錄儲存於獨立的事件表（避免影響會員表效能）
- 使用非同步處理機制（避免阻塞主流程）
- 統計數據可定期預先計算並快取（提升查詢效能）

**依賴關係**
- S_PM_002：需先有訊息圖文模板功能（設定互動標籤）
- S_CRM_003：需先有標籤管理功能

---

#### S_DA_002：標籤觸發儀表板

**Story**
作為一位飯店管理者，我希望系統提供視覺化的標籤觸發儀表板，展示不同標籤的觸發分布與成效（如：觸發趨勢圖、標籤排名、會員分布），以便快速了解會員的互動行為並調整行銷策略。

**驗收標準（AC）**

- ⚠️ 儀表板顯示以下關鍵指標（卡片形式）：
  - 總標籤數量
  - 總觸發次數（本月 vs 上月）
  - 活躍標籤數量（本月至少被觸發一次）
  - 平均每個標籤觸發人數
- ⚠️ 儀表板提供以下視覺化圖表：
  - **標籤觸發趨勢圖**（折線圖）：顯示近 30 天每日觸發次數
  - **熱門標籤排名**（橫條圖）：顯示觸發次數 Top 10 的標籤
  - **標籤分類分布**（圓餅圖）：顯示會員標籤 vs 活動標籤的觸發比例
  - **會員互動熱力圖**（日曆熱力圖）：顯示每日觸發活躍度
- ⚠️ 支援時間範圍篩選（本日、本週、本月、自訂範圍）
- ⚠️ 支援標籤類型篩選（會員標籤、活動標籤、全部）
- ❌ 點擊任一圖表元素可鑽取查看明細資料（v0.2）
- ❌ 支援儀表板佈局自訂（拖曳調整圖表位置）（v0.2）

**技術備註**
- 使用圖表庫（如 ECharts 或 Chart.js）實作視覺化
- 資料查詢使用預先計算的聚合表（提升效能）
- 支援即時刷新（WebSocket 或定期輪詢）
- 大數據量下使用分頁或資料採樣機制

**依賴關係**
- S_DA_001：需先有點擊標籤追蹤功能

---

#### S_DA_003：行銷活動 KPI 分析

**Story**
作為一位行銷主管，我希望系統能夠提供完整的行銷活動 KPI 分析（包含開啟率、點擊率、轉換率），並支援多活動比較與趨勢分析，以便評估不同行銷策略的成效並優化資源配置。

**驗收標準（AC）**

- ⚠️ 系統自動計算每個行銷活動的核心 KPI：
  - **發送人數**：訊息實際發送的會員數
  - **開啟率**：訊息被打開的不重複人數 / 發送人數
  - **點擊率**：訊息中互動按鈕被點擊的不重複人數 / 發送人數
  - **轉換率**：完成目標行為（如：訂房、填寫問卷）的人數 / 發送人數
- ⚠️ 活動分析頁面顯示以下資訊：
  - 活動基本資訊（活動名稱、發送時間、目標對象）
  - KPI 指標卡片（包含與平均值的比較）
  - 互動趨勢圖（按小時統計開啟與點擊數量）
  - 標籤觸發分布（該活動觸發了哪些標籤及其人數）
- ⚠️ 支援多活動比較功能：
  - 選擇 2-5 個活動進行並排比較
  - 顯示各活動的 KPI 指標對比圖（雷達圖或橫條圖）
  - 顯示各活動的成本效益分析（轉換成本 = 總成本 / 轉換人數）
- ❌ 支援活動效果預測（基於歷史資料預測新活動的預期成效）（v0.3）
- ❌ 支援 A/B 測試分析（比較不同訊息版本的成效）（v0.3）

**技術備註**
- 轉換率需定義「目標行為」（可設定為：點擊特定連結、填寫問卷、完成訂房）
- 成本效益分析需輸入活動成本（人工輸入或自動計算訊息配額費用）
- 多活動比較使用並排圖表檢視
- 預測功能需使用機器學習模型（如：線性迴歸、時間序列預測）

**依賴關係**
- S_PM_003：需先有訊息數據成效功能
- S_DA_001：需先有點擊標籤追蹤功能

---

#### S_DA_004：報表匯出

**Story**
作為一位飯店管理者，我希望系統能夠將標籤追蹤、活動成效、會員統計等數據匯出為 Excel 或 PDF 格式的報表，以便在離線環境下查閱或提交給上級主管作為決策參考。

**驗收標準（AC）**

- ❌ 支援匯出以下報表類型：
  - **標籤觸發報表**：包含標籤名稱、觸發次數、觸發人數、觸發率、時間範圍
  - **活動成效報表**：包含活動名稱、發送時間、發送人數、開啟率、點擊率、轉換率
  - **會員統計報表**：包含會員總數、新增會員數、標籤分布、互動活躍度
  - **訊息推播報表**：包含訊息清單、發送狀態、成效指標、配額使用情況
- ❌ 支援兩種匯出格式：
  - **Excel (.xlsx)**：包含多個工作表（每個報表類型一個工作表）、支援圖表嵌入
  - **PDF (.pdf)**：包含封面頁、目錄、各報表內容、圖表視覺化
- ❌ 匯出功能支援自訂參數：
  - 時間範圍（起始日期～結束日期）
  - 報表類型（多選）
  - 是否包含圖表
  - 是否包含明細資料
- ❌ 匯出過程顯示進度條（避免用戶以為系統卡住）
- ❌ 匯出完成後提供下載連結，檔案保留 7 天後自動刪除
- ❌ 系統記錄匯出日誌（匯出人、匯出時間、報表類型、檔案大小）

**技術備註**
- Excel 匯出使用 openpyxl 或 pandas 庫
- PDF 匯出使用 ReportLab 或 WeasyPrint 庫
- 大量資料匯出使用非同步任務（避免阻塞主流程）
- 匯出檔案暫存於伺服器，提供下載連結

**依賴關係**
- S_DA_001：需先有點擊標籤追蹤功能
- S_DA_002：需先有標籤觸發儀表板功能
- S_DA_003：需先有行銷活動 KPI 分析功能

---

## 模組五：帳號與授權登入

### 使用者故事

| 編號 | 名稱 | 優先級 | 實施狀態 |
|------|------|--------|---------|
| S_AUTH_001 | OA 管理專屬登入 | P0 | ✅ 已實施 |
| S_AUTH_002 | 子帳號管理 | P1 | ⚠️ 部分實施 |
| S_AUTH_003 | 權限控管 | P1 | ⚠️ 部分實施 |
| S_AUTH_004 | 多租戶管理 | P0 | ✅ 已實施 |
| S_AUTH_005 | 登入驗證方式 | P1 | ✅ 已實施 |

---

#### S_AUTH_001：OA 管理專屬登入

**Story**
作為一位飯店管理者，我希望系統提供專屬的 OA（Official Account）管理帳號登入功能，並支援安全的身份驗證機制，以便確保只有授權人員才能存取後台管理系統。

**驗收標準（AC）**

- ✅ 系統提供登入頁面，包含帳號、密碼輸入欄位
- ✅ 支援「記住我」功能（使用 Cookie 保存登入狀態 7 天）
- ✅ 支援「忘記密碼」功能（透過電子信箱重設密碼）
- ✅ 密碼需符合強度要求：
  - 至少 8 個字元
  - 包含大小寫字母、數字、特殊符號
- ✅ 登入失敗 5 次後，帳號鎖定 30 分鐘（防止暴力破解）
- ✅ 登入成功後，系統記錄登入日誌（登入時間、IP 位址、裝置資訊）
- ✅ 登入成功後，導向至儀表板首頁
- ✅ 若帳號未啟用或已停用，顯示明確的錯誤訊息

**技術備註**
- 密碼使用雜湊演算法加密（bcrypt 或 Argon2）
- Session 管理使用 JWT（JSON Web Token）
- 支援 CSRF 防護（Cross-Site Request Forgery）
- 登入日誌儲存於獨立的日誌表

**依賴關係**
- 無

---

#### S_AUTH_002：子帳號管理

**Story**
作為一位飯店管理者，我希望能夠建立與維護子帳號（客服 / 行銷 / 管理層），並為每個子帳號設定角色與權限，以便不同部門的員工可以使用各自的帳號存取系統，並避免權限混亂。

**驗收標準（AC）**

- ⚠️ 管理員可以新增子帳號，必填欄位包含：
  - 帳號名稱（唯一值）
  - 姓名
  - 電子信箱（唯一值）
  - 角色類型（客服 / 行銷 / 管理層 / 自訂角色）
  - 初始密碼（系統自動生成或手動輸入）
- ⚠️ 管理員可以編輯子帳號資料（姓名、電子信箱、角色類型）
- ⚠️ 管理員可以停用子帳號（停用後無法登入，但保留資料）
- ⚠️ 管理員可以刪除子帳號（需二次確認，軟刪除保留日誌）
- ⚠️ 子帳號首次登入時，系統強制要求修改初始密碼
- ⚠️ 子帳號清單顯示以下資訊：
  - 帳號名稱、姓名、角色、電子信箱、狀態（啟用/停用）、建立時間、最後登入時間
- ⚠️ 支援子帳號搜尋（依帳號名稱、姓名、電子信箱）與篩選（依角色、狀態）
- ❌ 支援批次匯入子帳號（Excel 範本）（v0.2）

**技術備註**
- 角色與權限分離（Role-Based Access Control, RBAC）
- 初始密碼發送至電子信箱（使用加密連結）
- 軟刪除使用 deleted_at 欄位標記
- 最後登入時間於每次登入時更新

**依賴關係**
- S_AUTH_001：需先有 OA 管理專屬登入功能
- S_AUTH_003：需先有權限控管功能

---

#### S_AUTH_003：權限控管

**Story**
作為一位系統管理員，我希望能夠為不同角色設定細緻的權限控管（讀取 / 編輯 / 推播 / 報表下載），並支援自訂角色與權限組合，以便靈活管理不同員工的系統存取權限，確保資料安全。

**驗收標準（AC）**

- ⚠️ 系統預設三種角色：
  - **客服**：可讀取會員資料、查看訊息紀錄、回覆訊息（不可編輯會員資料、不可推播訊息）
  - **行銷**：可讀取會員資料、建立訊息推播、查看數據分析（不可刪除會員、不可管理子帳號）
  - **管理層**：擁有所有權限（包含管理子帳號、查看所有報表、匯出資料）
- ⚠️ 系統支援自訂角色：
  - 管理員可新增自訂角色並設定角色名稱
  - 管理員可為自訂角色勾選以下權限：
    - **會員管理**：讀取、新增、編輯、刪除
    - **訊息推播**：讀取、建立、編輯、刪除、發送
    - **標籤管理**：讀取、新增、編輯、刪除
    - **數據分析**：查看儀表板、查看報表、匯出報表
    - **帳號管理**：查看子帳號、新增子帳號、編輯子帳號、刪除子帳號
- ⚠️ 子帳號登入後，系統根據角色權限動態顯示功能選單（無權限的功能不顯示）
- ⚠️ 若子帳號嘗試存取無權限的功能，系統顯示「無存取權限」提示並記錄日誌
- ❌ 支援權限繼承機制（如：管理層自動繼承行銷與客服權限）（v0.2）
- ❌ 支援權限有效期設定（如：臨時權限有效期 7 天）（v0.3）

**技術備註**
- 使用 RBAC（Role-Based Access Control）模型
- 權限檢查使用裝飾器或中介層（Middleware）
- 權限設定儲存於 JSON 格式（靈活擴展）
- 權限變更需記錄操作日誌

**依賴關係**
- S_AUTH_002：需先有子帳號管理功能

---

#### S_AUTH_004：多租戶管理

**Story**
作為一位 SaaS 平台管理員，我希望系統能夠支援多租戶架構，確保不同飯店客戶的資料完全隔離，並提供租戶管理介面（建立租戶、分配資源、監控使用情況），以便安全地為多家飯店提供 CRM 服務。

**驗收標準（AC）**

- ✅ 系統支援多租戶資料隔離：
  - 每個租戶擁有獨立的資料空間（會員資料、訊息紀錄、標籤資料）
  - 租戶 A 的使用者無法存取租戶 B 的資料
  - 租戶識別碼（tenant_id）自動附加於所有資料查詢
- ✅ 平台管理員可以新增租戶，必填欄位包含：
  - 租戶名稱（飯店名稱）
  - 租戶識別碼（唯一值，自動生成或手動輸入）
  - 管理員帳號（初始帳號與密碼）
  - 租戶方案（基礎版 / 進階版 / 企業版）
  - 配額設定（訊息發送配額、會員數量上限、儲存空間上限）
- ✅ 平台管理員可以編輯租戶資料（租戶名稱、方案、配額）
- ✅ 平台管理員可以停用租戶（停用後該租戶所有使用者無法登入）
- ✅ 平台管理員可以查看租戶使用情況：
  - 會員總數、訊息發送總數、儲存空間使用量
  - 配額使用率（如：訊息配額使用 80%）
  - 最後登入時間
- ⚠️ 支援租戶資料匯出（備份用途）（v0.2）
- ⚠️ 支援租戶資料搬遷（從測試環境搬遷至正式環境）（v0.2）

**技術備註**
- 使用 tenant_id 作為資料隔離的關鍵欄位（所有資料表包含此欄位）
- 使用 Row-Level Security（行級安全）確保資料隔離
- 配額檢查使用中介層（Middleware）在每次操作前驗證
- 租戶方案與配額設定儲存於獨立的配置表

**依賴關係**
- S_AUTH_001：需先有 OA 管理專屬登入功能

---

#### S_AUTH_005：登入驗證方式

**Story**
作為一位飯店管理者，我希望系統支援多種登入驗證方式（帳號密碼 / OTP 驗證 / 社群帳號登入），並可設定強制使用雙因素驗證（2FA），以便提升帳號安全性，防止未授權存取。

**驗收標準（AC）**

- ✅ 支援傳統帳號密碼登入（預設方式）
- ✅ 支援 OTP（One-Time Password）驗證：
  - 使用者可選擇啟用 OTP 驗證
  - 啟用後，登入時需輸入帳號密碼 + OTP 驗證碼
  - OTP 驗證碼透過電子信箱或簡訊發送（6 位數字，有效期 5 分鐘）
- ⚠️ 支援社群帳號登入（v0.2）：
  - Google 帳號登入
  - LINE 帳號登入
  - 首次社群帳號登入需綁定系統帳號
- ⚠️ 管理員可設定強制使用雙因素驗證（2FA）：
  - 針對特定角色（如：管理層）強制啟用 2FA
  - 未啟用 2FA 的使用者登入時強制導向 2FA 設定頁面
- ✅ 支援登入裝置記憶功能（已驗證的裝置 30 天內免 OTP）
- ✅ 使用者可在帳號設定中查看已記憶的裝置清單並移除裝置

**技術備註**
- OTP 驗證使用 TOTP（Time-based OTP）演算法
- 社群帳號登入使用 OAuth 2.0 協定
- 裝置記憶使用 Cookie 或 Device Fingerprint
- 2FA 設定儲存於使用者設定表

**依賴關係**
- S_AUTH_001：需先有 OA 管理專屬登入功能

---

## 模組六：會員管理

### 使用者故事

| 編號 | 名稱 | 優先級 | 實施狀態 |
|------|------|--------|---------|
| S_MM_001 | 會員管理 | P0 | ✅ 已實施 |
| S_MM_002 | 搜尋與篩選 | P0 | ✅ 已實施 |
| S_MM_003 | 標籤管理 | P0 | ✅ 已實施 |
| S_MM_004 | 訊息紀錄 | P1 | ✅ 已實施 |

---

#### S_MM_001：會員管理

**Story**
作為一位客服人員，我希望能夠查看會員的完整資料（包含 LINE 資訊、個人資料、標籤、消費紀錄），並支援新增內部備註，以便全面了解會員的背景與需求，提供更好的客戶服務。

**驗收標準（AC）**

- ✅ 以清單形式顯示會員清單：
  - LINE 會員頭像 + 名稱
  - 姓名
  - 電子信箱
  - 手機號碼
  - 標籤（會員 + 互動）
  - 建立時間
  - 最後回覆日期
- ✅ 點擊「查看」動作，可以查看會員的詳細資料，欄位如：
  - LINE 會員頭像 + 名稱
  - 姓名、性別、生日
  - 電子信箱、手機號碼、身分證/護照號碼（唯一值）
  - 加入來源（LINE / CRM / 系統）
  - 建立時間、最後回覆日期、LINE UID
  - 標籤（會員 + 互動）
- ✅ 點擊「聊天」動作，可以進到與該會員的一對一聊天訊息紀錄
- ⚠️ 若有串接 CRM，則可查看該會員的消費紀錄，如：消費時間、金額、房型或套餐，找出消費頻率（v0.2）
- ✅ 顯示會員的建立時間與紀錄最後回覆訊息的日期
- ✅ 內部人員可增加備註，註記該會員的消費習慣與喜好

**技術備註**
- 會員清單支援分頁顯示（每頁 20 筆）
- 消費紀錄需整合 PMS 系統（v0.2）
- 備註功能支援富文本編輯器（可加粗、換行）

**依賴關係**
- S_CRM_001：需先有新增會員功能
- S_CRM_002：需先有會員資料管理功能
- S_PMS_002：消費紀錄需依賴 PMS 住宿紀錄同步

---

#### S_MM_002：搜尋與篩選

**Story**
作為一位客服人員，我希望能夠透過 LINE 名稱、姓名、電子信箱、手機號碼進行搜索，並依會員標籤、性別、建立來源、最近回覆日期進行篩選與排序，以便快速找到需要聯繫的會員並優先處理最近聊天的會員。

**驗收標準（AC）**

- ✅ 可以 LINE 名稱、姓名、電子信箱、手機號碼進行搜索（模糊匹配）
- ✅ 可以會員標籤、性別、建立來源（LINE 官方帳號 / CRM / 後台系統）進行篩選
- ✅ 可以最近回覆的日期排序，找出最近聊天的會員進行回覆
- ✅ 搜尋結果即時更新（輸入時自動觸發搜尋）
- ✅ 顯示目前套用的篩選條件，可快速清除
- ✅ 搜尋結果顯示符合條件的會員數量

**技術備註**
- 使用全文索引優化搜尋效能
- 搜尋結果快取機制（提升重複查詢效能）
- 支援多條件組合篩選（AND / OR 邏輯）

**依賴關係**
- S_MM_001：需先有會員管理功能
- S_CRM_003：需先有標籤管理功能

---

#### S_MM_003：標籤管理

**Story**
作為一位行銷人員，我希望能夠在查看會員詳細資料時，新增或刪除會員標籤（如：生日、年齡、地區、性別、會員等級）和互動標籤（如：點擊圖文訊息、圖文選單、廣告互動），以便持續優化會員的標籤輪廓，提升行銷精準度。

**驗收標準（AC）**

- ✅ **會員標籤**：
  - 標籤來源為 API 抓取或自訂
  - 查看詳細資料時，可新增或刪除會員標籤
  - 常見標籤如：生日、年齡、地區、性別、會員等級等
- ✅ **互動標籤**：
  - 標籤來源為系統新增或自訂
  - 查看詳細資料時，可新增或刪除互動標籤
  - 常見標籤如：點擊圖文訊息、圖文選單、廣告互動所貼上的標籤
- ✅ 新增標籤時，可從已建立的標籤清單中選擇，或輸入新標籤名稱（自動建立）
- ✅ 刪除標籤時，僅移除該會員與標籤的關聯（不刪除標籤本身）
- ✅ 標籤變更後，即時更新會員詳細資料頁面與會員清單

**技術備註**
- 標籤與會員為多對多關係（需建立關聯表）
- API 抓取的標籤需標記來源（避免手動誤刪）
- 系統自動新增的標籤需標記來源（互動觸發）

**依賴關係**
- S_CRM_003：需先有標籤管理功能
- S_MM_001：需先有會員管理功能

---

#### S_MM_004：訊息紀錄

**Story**
作為一位客服人員，我希望能夠查看與會員的一對一訊息聊天記錄，並可用純文字或圖文訊息模板向會員發送訊息（支援排程發送），同時能識別訊息來源（人工回覆 / 訊息推播 / 自動回應），以便提供即時且個人化的客戶服務。

**驗收標準（AC）**

- ✅ 可與該會員進行一對一的訊息聊天記錄，顯示：
  - LINE 會員頭像 + 名稱
  - 雙方每一筆的聊天記錄、傳送時間
  - 開啟對話的日期
  - 訊息為即時更新（透過 WebSocket 或定期輪詢）
- ✅ 可以用純文字的方式向會員發送訊息，並且可排程日期、時間進行人工發送
- ✅ 可識別訊息回覆來源：
  - 人工回覆：顯示帳號名稱
  - 訊息推播：顯示「訊息推播」標籤
  - 自動回應：顯示「自動回應」標籤
- ✅ 可部分檢視該會員的基本資訊，如：
  - 姓名、性別、生日
  - 電子信箱、手機號碼、身分證/護照號碼
  - 可編輯備註
- ✅ 可檢視該會員標籤：會員標籤 + 互動標籤，且可新增或刪除
- ⚠️ 支援發送圖文訊息模板（選擇已建立的模板）（v0.2）
- ⚠️ 支援發送圖片或檔案（v0.2）

**技術備註**
- 整合 LINE Messaging API 的 Push Message 功能
- 訊息即時更新使用 WebSocket 或定期輪詢（每 5 秒）
- 排程發送使用任務排程器（如 Celery）
- 訊息來源標記儲存於訊息記錄表

**依賴關係**
- S_MM_001：需先有會員管理功能
- S_PM_002：發送圖文訊息模板需依賴訊息圖文模板功能

---

## 模組七：問卷模板

### 使用者故事

| 編號 | 名稱 | 優先級 | 實施狀態 |
|------|------|--------|---------|
| S_ST_001 | 建立問卷 | P1 | ✅ 已實施 |
| S_ST_002 | 題目管理 | P1 | ✅ 已實施 |
| S_ST_003 | 多元題型 | P1 | ✅ 已實施 |
| S_ST_004 | 發送管理 | P1 | ✅ 已實施 |

---

#### S_ST_001：建立問卷

**Story**
作為一位行銷人員，我希望能建立結構化問卷並選擇適合的範本，以便快速部署不同類型的會員調查（如：滿意度調查、偏好收集、會員資料完善）。

**驗收標準（AC）**

- ✅ 使用者可輸入問卷名稱（必填）
- ✅ 使用者可從問卷範本清單中選擇適合的範本（必填）
- ✅ 選擇範本後，系統顯示範本描述和預設題目
- ⚠️ 系統暫未移除「問卷描述」欄位（v0.2 將移除）
- ✅ 使用者可預覽問卷範本的預設題目與樣式
- ✅ 使用者可在選擇範本後自訂題目內容

**技術備註**
- 問卷範本預先定義於資料庫（管理員可新增範本）
- 範本包含預設題目清單（可編輯）
- 問卷資料儲存於 surveys 表，題目儲存於 survey_questions 表

**依賴關係**
- 無

---

#### S_ST_002：題目管理

**Story**
作為一位內容管理者，我希望能靈活新增、編輯、刪除問卷題目，並即時預覽效果，以確保問卷設計符合需求並提升會員填答體驗。

**驗收標準（AC）**

- ✅ 使用者可點擊「新增題目」按鈕開啟題目編輯器
- ✅ 題目編輯器支援：
  - 選擇題型（下拉選單）
  - 輸入題目文字（文字輸入框）
  - 設定字型大小（下拉選單：小 / 中 / 大）
  - 標記必填（核取方塊）
- ✅ 使用者可編輯現有題目（點擊題目卡片進入編輯模式）
- ✅ 使用者可刪除現有題目（需二次確認）
- ✅ 題目順序自動編號（Q1, Q2, Q3...）
- ⚠️ 暫未實施題目拖曳排序功能（v0.2 將實施）
- ✅ 右側手機模擬器即時預覽題目效果（包含題目文字、字型大小、必填標記）

**技術備註**
- 題目編輯器使用 Modal 或 Drawer 元件
- 即時預覽使用 React 狀態管理（即時更新）
- 題目拖曳排序將使用 react-beautiful-dnd 或 dnd-kit 庫（v0.2）

**依賴關係**
- S_ST_001：需先有建立問卷功能

---

#### S_ST_003：多元題型

**Story**
作為一位使用者，我希望系統支援多種題型（如姓名、電話、電子郵件、圖片、影片等），以蒐集不同類型的會員資訊並提升問卷的互動性。

**驗收標準（AC）**

- ✅ 支援基本資料類題型：
  - 姓名（文字輸入框）
  - 電話（文字輸入框，支援格式驗證）
  - 電子郵件（文字輸入框，支援格式驗證）
  - 生日（日期選擇器）
  - 地址（文字輸入框）
  - 性別（單選：男 / 女 / 其他）
  - 身分證字號（文字輸入框，支援格式驗證）
- ✅ 支援多媒體類題型：
  - 超連結（顯示連結文字與 URL，可點擊開啟）
  - 影片（顯示影片描述與影片超連結範例）
  - 圖片（顯示圖片描述與圖片超連結範例）
- ✅ 影片題型支援：
  - 影片描述（文字輸入框）
  - 影片超連結（文字輸入框，範例連結）
- ✅ 圖片題型支援：
  - 圖片描述（文字輸入框）
  - 圖片超連結（文字輸入框，範例連結）
- ⚠️ 暫未實施「輸入限制」功能（最小長度/最大長度），已於 v0.1 移除
- ⚠️ 未來版本將支援上傳圖片與影片檔案（v0.2）

**技術備註**
- 題型定義儲存於 question_types 配置表
- 格式驗證使用正則表達式（電話、電子郵件、身分證）
- 多媒體題型目前僅支援超連結（v0.1）
- 未來版本將整合檔案上傳功能（v0.2）

**依賴關係**
- S_ST_002：需先有題目管理功能

---

#### S_ST_004：發送管理

**Story**
作為一位行銷人員，我希望能選擇發送對象並設定排程，以在適當時機將問卷發送給目標會員，並支援草稿儲存與編輯功能。

**驗收標準（AC）**

- ✅ 使用者可選擇發送對象：
  - 所有好友
  - 篩選目標對象（依基礎會員標籤篩選）
- ✅ 使用者可選擇排程發送：
  - 立即發送
  - 自訂發送時間（日期時間選擇器，格式：YYYY-MM-DD HH:mm:ss）
- ✅ 自訂發送時間支援日期時間選擇器（可選擇未來的日期與時間）
- ✅ 使用者可儲存草稿或發布給用戶
- ✅ 系統驗證必填欄位後才允許提交：
  - 問卷名稱（必填）
  - 問卷範本（必填）
  - 至少一個題目（必填）
  - 發送對象（必填）
  - 排程發送（必填）
- ✅ 發送前顯示確認提示（發送對象人數、預計發送時間）
- ✅ 發送成功後，系統顯示成功提示並導向問卷清單頁面

**頁面佈局設計**（v0.1 實施版本）：
- ✅ **左側區域**：表單輸入區，包含：
  - 基本設定（問卷名稱、問卷範本）
  - 發送設定（發送對象、排程發送）
  - 問卷內容（題目管理）
- ✅ **右側區域**：手機模擬器即時預覽，展示：
  - 問卷名稱
  - 題目列表
  - 輸入欄位樣式

**技術備註**
- 排程發送使用任務排程器（如 Celery 或 APScheduler）
- 草稿儲存於資料庫，狀態標記為 "draft"
- 發送對象篩選需整合標籤管理功能
- 發送成功後需記錄發送日誌

**依賴關係**
- S_ST_001：需先有建立問卷功能
- S_ST_002：需先有題目管理功能
- S_CRM_003：需先有標籤管理功能（用於篩選對象）

---

## 附錄

### 使用者故事總覽

| 模組 | 總數 | P0 | P1 | P2 | 已實施 | 部分實施 | 未實施 |
|------|------|----|----|----|----|----|----|
| 模組一：LineOA CRM 管理後台 | 4 | 3 | 1 | 0 | 4 | 0 | 0 |
| 模組二：活動與訊息推播 | 4 | 2 | 2 | 0 | 4 | 0 | 0 |
| 模組三：PMS 串接模組 | 3 | 0 | 3 | 0 | 0 | 0 | 3 |
| 模組四：標籤追蹤與數據分析 | 4 | 1 | 2 | 1 | 1 | 2 | 1 |
| 模組五：帳號與授權登入 | 5 | 2 | 3 | 0 | 3 | 2 | 0 |
| 模組六：會員管理 | 4 | 3 | 1 | 0 | 4 | 0 | 0 |
| 模組七：問卷模板 | 4 | 0 | 4 | 0 | 4 | 0 | 0 |
| **總計** | **28** | **11** | **16** | **1** | **20** | **4** | **4** |

### 實施優先級建議

**v0.1 核心功能（已實施）**：
- S_CRM_001, S_CRM_002, S_CRM_003, S_CRM_004
- S_PM_001, S_PM_002, S_PM_003, S_PM_004
- S_DA_001
- S_AUTH_001, S_AUTH_004, S_AUTH_005
- S_MM_001, S_MM_002, S_MM_003, S_MM_004
- S_ST_001, S_ST_002, S_ST_003, S_ST_004

**v0.2 優化與擴展**：
- S_AUTH_002, S_AUTH_003（完善權限管理）
- S_DA_002, S_DA_003（完善數據分析）
- S_PMS_001, S_PMS_002, S_PMS_003（PMS 串接）

**v0.3 進階功能**：
- S_DA_004（報表匯出）
- 其他進階功能（A/B 測試、效果預測）

### 關鍵依賴關係圖

```
S_CRM_001 (新增會員)
  ├─> S_CRM_002 (會員資料管理)
  │     ├─> S_CRM_003 (標籤管理)
  │     │     ├─> S_CRM_004 (客戶搜尋與篩選)
  │     │     ├─> S_PM_001 (建立訊息推播)
  │     │     ├─> S_DA_001 (點擊標籤追蹤)
  │     │     └─> S_MM_003 (標籤管理)
  │     ├─> S_MM_001 (會員管理)
  │     │     ├─> S_MM_002 (搜尋與篩選)
  │     │     └─> S_MM_004 (訊息紀錄)
  │     └─> S_PMS_001 (PMS 客戶資料同步)
  │           └─> S_PMS_002 (PMS 住宿紀錄同步)
  │                 └─> S_PMS_003 (PMS 資料比對機制)
  │
  ├─> S_PM_002 (訊息圖文模板)
  │     ├─> S_PM_001 (建立訊息推播)
  │     │     └─> S_PM_003 (訊息數據成效)
  │     └─> S_PM_004 (自動回應)
  │
  ├─> S_DA_001 (點擊標籤追蹤)
  │     ├─> S_DA_002 (標籤觸發儀表板)
  │     │     └─> S_DA_003 (行銷活動 KPI 分析)
  │     │           └─> S_DA_004 (報表匯出)
  │
  ├─> S_AUTH_001 (OA 管理專屬登入)
  │     ├─> S_AUTH_002 (子帳號管理)
  │     │     └─> S_AUTH_003 (權限控管)
  │     ├─> S_AUTH_004 (多租戶管理)
  │     └─> S_AUTH_005 (登入驗證方式)
  │
  └─> S_ST_001 (建立問卷)
        └─> S_ST_002 (題目管理)
              ├─> S_ST_003 (多元題型)
              └─> S_ST_004 (發送管理)
```

---

**文檔結束**
