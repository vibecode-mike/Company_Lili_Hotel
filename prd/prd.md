# 力麗飯店 LineOA CRM 管理後台 PRD v1.1

**文檔版本**: v1.1
**最後更新**: 2025-10-09
**實施狀態**: v0.1 開發中

**實施說明**:
- ✅ 模組一、二、四、五、六已部分實施
- ⚠️ 模組三 (PMS串接) 暫未實施,改為獨立會員管理
- 📋 後端技術棧: FastAPI 0.104.1 + MySQL + LINE Messaging API + OpenAI API
- 📋 前端技術棧: React 19 + TypeScript 5.9 + Ant Design 5.27 + Vite 7
- 📋 後端端口: 8700, 前端開發端口: 5174

---

## 1. 項目概念框架

### 1.1 項目背景

飯店行銷目前常依靠大規模廣告推播或人工客服進行會員維護，但缺乏精準分眾與個人化互動。這導致：
- 行銷轉換率低
- 人力成本高
- 客戶洞察不足

**解決方案**：建立一個可控的 LineOA CRM 管理後台，並與德安 PMS 系統整合，透過標籤化管理與行銷活動推播，讓飯店能精準觸及不同客群，提升會員經營效率與行銷成效的 SAAS 服務。

### 1.2 核心目標

1. 建立可控 LineOA 的 CRM 管理後台並整合德安的會員管理系統資料 (PMS)
2. 支援排程訊息推送、活動上架與活動標籤設定（客戶點擊後觸發標籤）
3. 提供點擊標籤追蹤與標籤觸發儀表板，提升客戶洞察精準度
4. 透過會員標籤，實現指向性行銷（依標籤群體推送訊息）

### 1.3 成功指標

| 指標 | 目標值 |
|------|--------|
| PMS 與 LineOA 整合會員比對成功率 | ≥ 95%（依身分證/手機號碼關聯） |
| 排程與活動訊息推播成功率 | ≥ 99% |
| 依標籤推播的行銷轉換率提升 | ≥ 25% |
| 建立活動標籤自動化行銷場景 | ≥ 3 種（例：商務住宿優惠、家庭旅遊推播、VIP 續住優惠） |

---

## 2. 用戶分析

### 2.1 目標用戶畫像

| 用戶類型 | 角色描述 | 核心需求 |
|---------|---------|---------|
| **最終客戶（飯店顧客）** | 使用 LineOA 接收訊息 | 接收與自身相關的優惠/活動，實現轉化，而非無關推播 |
| **客服/行銷人員（飯店端）** | 後台操作人員 | 簡單設定活動、排程推送，即時追蹤標籤觸發情況 |
| **飯店管理者** | 決策者 | 透過儀表板了解不同標籤客群的互動行為與行銷轉換率，制定或調整策略 |

### 2.2 用戶場景分析

1. **顧客端場景**：加入飯店 LineOA，接收住宿優惠或活動訊息，點擊訊息後自動掛上相關標籤（例：對「商務住宿優惠」有興趣）
2. **客服端場景**：行銷人員在後台設定「平日商務優惠活動」，並排程於特定日期推送，系統自動將點擊者打上「商務客」標籤
3. **管理端場景**：飯店經理透過標籤觸發儀表板，查看「商務客」點擊率、後續訂房率，並據此調整後續活動

### 2.3 用戶旅程地圖

| 序 | 階段 | 客戶端行為 | 系統回應 | 管理端行為 | 期望價值 |
|----|------|-----------|---------|-----------|---------|
| 1 | 加入會員 | 顧客加入 LineOA 並輸入身分證/手機 | 與 PMS 比對資料，建立會員檔案 | – | 會員資料整合，減少重複輸入 |
| 2 | 活動推播 | 收到排程訊息/優惠活動 | 依標籤分眾推播，顧客可點擊互動 | 行銷人員設定活動與排程 | 提升訊息相關性與開啟率 |
| 3 | 標籤觸發 | 顧客點擊訊息連結/互動按鈕 | 系統新增「活動標籤」並紀錄客戶端觸發「活動推播」 | 行銷人員可調整標籤設定 | 透過行為標籤，累積更精準的客戶輪廓 |
| 4 | 行為追蹤 | – | 系統收集標籤觸發紀錄並更新儀表板 | 管理者查看觸發數據與分布 | 提供數據化的客戶洞察，支援行銷策略決策 |
| 5 | 成效分析 | – | 系統生成報表：標籤觸發率、活動轉換成效 | 管理者檢視活動 ROI 與客群反應 | 量化行銷成果，提升會員經營效率 |

---

## 3. 功能需求

### 模組一：LineOA CRM 管理後台

**核心功能**：
- 新增會員（電子信箱、行動電話、姓、名、性別、身分證/護照號碼）
- 會員資料管理（修改刪除與德安同步：觸發標籤、電子信箱、行動電話、姓、名、性別、身分證/護照號碼、住宿紀錄資訊、是否接收優惠通知）
- 標籤管理（基礎會員標籤 + 活動標籤）
- 客戶搜尋與篩選（依標籤、日期時間、住宿紀錄、互動行為紀錄）

---

### 模組二：活動與訊息推播

#### 目的
支援行銷活動的推廣設置訊息模板，並決定訊息的排程、特定觸發的時機，能夠依據會員標籤或行為分群來選擇發送對象，讓訊息在對的時間送給對的人，提升訊息整體的精準度與自動化，可有效控制廣告預算並增加轉換率。

#### 核心功能

| 功能 | 描述 |
|------|------|
| 1. 建立訊息推播 | 可依基礎會員標籤篩選對象、設定時間排程，自動將訊息發送給目標會員 |
| 2. 訊息圖文模板 | 提供多種文字與圖文模板（如：純文字、文字按鈕確認型、圖片點擊型、圖卡按鈕型），支援互動按鈕與輪播，每個互動點擊後都能回收數據、標籤，且能設置互動結果 |
| 3. 訊息數據成效 | 提供訊息發送後的即時與歷史成效指標，涵蓋互動行為與發送紀錄。互動行為包含開啟次數（訊息被打開已讀的不重複次數）、點擊次數（訊息中觸發互動按鈕、連結的不重複次數） |
| 4. 自動回應 Reply v0.3 | 於顧客行為自動觸發（如：歡迎訊息、關鍵字回覆） |

#### User Stories

| 編號 | 名稱 | Story |
|------|------|-------|
| S_PM_001 | 建立訊息推播 | 作為一位行銷人員，我希望建立訊息並支援排程推播，同時能夠精準鎖定目標受眾並提前預估發送配額，以便高效部署和管理我的品牌行銷活動 |
| S_PM_002 | 訊息圖文模板 | 作為一位內容管理者，我希望有一套靈活的機制來建立多媒體、高互動性的訊息模板，維持用戶對品牌的新鮮感與參與度，以利蒐集更多用戶的行為數據 |
| S_PM_003 | 訊息數據成效 | 作為一位行銷數據人員，我希望系統存取所有已發訊息的歷史成效數據，以利分析用戶對內容與互動的偏好，來為下個季度做行銷的優化與調整 |
| S_PM_004 | 自動回應 v0.3 | 作為一位使用者，我希望設定歡迎訊息，當用戶加入本帳號好友時自動觸發，以利在第一時間與用戶互動不疏漏，且可蒐集用戶資訊支持 CRM（會員資料整合） |

#### 驗收標準（AC）

##### S_PM_001：建立訊息推播

- ✅ 使用者可以從已建立的訊息圖文模板中選擇並建立群發訊息
- ✅ 訊息發送之前，支援訊息效果的即時模擬與預覽功能
- ✅ 必須能夠選擇以下任一傳送對象：所有好友、篩選目標對象（依據基礎會員標籤進行篩選，並支援包含或排除指定條件的組合邏輯）
- ✅ 使用者能夠選擇立即傳送，或於指定發送日期（YYYY/MM/DD）與發送時間（HH:MM）進行排程傳送
- ✅ 使用者可選擇訊息特定的觸發條件，如：加入好友期間的 7～29 天
- ✅ 在確認發送前，系統必須顯示此次訊息的預計發送好友人數、即當前可用訊息的配額用量
- ✅ 若可用訊息的配額用量 < 預計發送的好友人數，系統須阻擋發送行為，並向使用者顯示明確的提示
- ✅ 當編輯到一半，離開視窗則彈窗提示
- ✅ 可以將未完成設定的群發訊息儲存為草稿，並支援隨時可開啟編輯

##### S_PM_002：訊息圖文模板

**支援 4 種訊息圖文模板類型**：

| 類型 | 類型名稱 | 核心組成 | 互動性 |
|------|---------|---------|--------|
| Template01 | 純文字 | 文字* | 無 |
| Template02 | 文字按鈕確認型 | 文字* / 按鈕 | 有 |
| Template03 | 圖片點擊型 | 圖片* / 按鈕 | 有 |
| Template04 | 圖卡按鈕型 | 圖片* / 標題* / 內文 / 金額 / 按鈕 | 有 |

**模板功能要求**：

- ✅ 適用於圖片點擊型、圖卡按鈕型模板：須支援多張輪播圖卡（最多 9 張），且輪播功能須支援預覽、編輯、圖片排序調整、刪除等操作
- ✅ 適用於圖片點擊型模板：圖片為必填、可選擇圖面下方是否顯示動作按鈕，且可調整按鈕文字、每張輪播圖可設定用於數據追蹤的互動標籤，以及用戶點擊此圖卡後觸發的互動結果
- ✅ 適用於圖卡按鈕型模板：圖片與標題為必填、可選填內文描述/金額數值、並可選擇顯示的文字按鈕數量（最多 2 個）、每張輪播圖卡可設定用於數據追蹤的互動標籤，以及用戶點擊此圖卡後觸發的互動結果
- ✅ 所有涉及圖片的模板皆可上傳圖片，圖片比例應為 1:1，檔案大小支援 1 MB 以下，可重新上傳
- ✅ 當上傳圖片不符合 1:1 比例，系統採 Fill 填滿處理，確保圖片完整顯示
- ✅ 每個模板可設定用於數據追蹤的互動標籤，標籤為選填（Future：可支援 AI 推薦標籤）
- ✅ 每個模板可設定用戶點擊此圖卡後觸發的互動結果，必填。當用戶點擊後觸發的動作類型如：無互動、開啟網址連結、觸發新訊息（須定義訊息文字）、觸發新圖片（須上傳圖片檔案）
- ✅ 適用於文字按鈕確認型、圖片點擊型、圖卡按鈕型模板：須設定通知訊息，為用戶透過手機 LINE APP 推播時會收到的簡短通知內容
- ✅ 適用於文字按鈕確認型、圖片點擊型、圖卡按鈕型模板：須設定訊息預覽，為用戶在尚未進入對話窗前看到的訊息內容，通常顯示為訊息的最後一行

##### S_PM_003：訊息數據成效

- ✅ 以清單形式顯示訊息發送清單：縮圖（若無圖片則為系統預設圖）、傳送時間、傳送人數、部分訊息內容、開啟次數（訊息被打開已讀的不重複次數）、點擊次數（訊息中觸發互動按鈕、連結的不重複次數）
- ✅ 系統須識別訊息的 4 種發送狀態，並依據狀態附帶其可編輯性：
  - 排程發送（可編輯）
  - 已發送（不可編輯）
  - 草稿（可編輯）
  - 發送失敗（顯示失敗原因：訊息額度不足）
- ✅ 支援依據訊息的傳送時間進行篩選，允許帶入起始時間或結束時間來搜索歷史訊息
- ✅ 當點擊任一訊息後，進入查看詳細頁面，如：廣告成效趨勢圖（折線圖）、可檢視發送對象的清單、完整的訊息內容

##### S_PM_004：自動回應 v0.3

- ✅ 支援事先設定訊息回應內容，被觸發有 3 種方式：
  1. 新好友歡迎訊息
  2. 輸入關鍵字觸發
  3. 選擇指定時間觸發
- ✅ 選擇新好友歡迎訊息，可設定訊息觸發訊息
- ✅ 選擇關鍵字觸發訊息，可輸入多組關鍵字（最多 20 組），收到用戶與任一關鍵字相配時進行回覆，觸發到的關鍵字會記錄於後台
- ✅ 選擇指定時間觸發，可選擇指定日期區間或時間區間（例：非營業時間觸發）
- ✅ 訊息回應格式以純文字為主，未來可選擇插入訊息圖文模板，或是上傳圖片檔案
- ✅ 設定自動回應訊息至少 1 筆（最多 5 筆），可以新增或刪除
- ✅ 支援發送前的效果即時預覽
- ✅ 設定完成，可將該訊息內容選擇停用或刪除，停用則不會啟動觸發，刪除則無法復原須重新設定
- ✅ 設定完成，可編輯該訊息內容，於用戶下次更新即觸發更新後的內容
- ✅ 於訊息外部可以查看訊息的停用與啟用狀態、回應的類型（如：歡迎訊息 / 關鍵字 / 指定時間）

---

### 模組三：PMS 串接模組 (⚠️ v0.1 未實施)

**實施狀態**: 暫未實施,v0.1版本改為獨立會員管理系統

**原規劃核心功能**：
- 與德安 PMS 同步客戶資料（與德安同步：觸發標籤、電子信箱、行動電話、姓、名、性別、身分證/護照號碼、住宿紀錄資訊、是否接收優惠通知、入住紀錄、房型、住宿日期）
- 以身分證字號/手機號碼作關聯
- 定期更新機制，確保資料一致性

**當前替代方案 (v0.1)**：
- 使用系統內建的會員管理功能 (模組六)
- 支援手動新增會員資料
- 支援從 LINE 官方帳號同步會員資訊
- 未來版本可擴展PMS集成功能

---

### 模組四：標籤追蹤與數據分析

**核心功能**：
- 點擊標籤追蹤（紀錄觸發次數與人數）
- 標籤觸發儀表板（展示分布與成效）
- 行銷活動 KPI 分析（開啟率、點擊率、轉換率）
- 報表匯出（Excel/PDF）

---

### 模組五：帳號與授權登入

**核心功能**：
- 支援 OA 管理專屬登入帳號
- 管理員建立與維護子帳號（客服 / 行銷 / 管理層）
- 權限控管（讀取 / 編輯 / 推播 / 報表下載）
- SaaS 架構下的多租戶管理（每家飯店資料隔離）
- 支援常見登入驗證方式（帳號密碼 / OTP 驗證）

---

### 模組六：會員管理（Member Management）

#### 目的
將 LINE 官方帳號會員的基本資料與互動行為（如：加入時間、訊息紀錄、活動參與）整合至後台，透過系統化工具支援行銷、客服人員，可對會員進行精準管理，統一平台管理可簡化人工操作流程，減少重複作業。

#### 核心功能

| 功能 | 描述 |
|------|------|
| 1. 會員管理 | 支援 CRUD，抓取會員的會員資訊<br>• 會員資訊：LINE 會員頭像＋名稱、姓名、性別、生日、電子信箱、手機號碼、身分證/護照號碼（唯一值）、加入來源、建立時間、最後互動日期、LINE UID<br>• 會員標籤：如生日、年齡、地區、性別等<br>• 活動標籤：如點擊圖文訊息的互動紀錄<br>• 消費紀錄：消費時間、金額、房型或套餐，可查看消費頻率<br>• 紀錄會員的建立時間與最後互動時間（訊息聊天） |
| 2. 搜尋與篩選 | 支援會員搜尋、篩選、排序，透過精準或模糊的方式進行會員查找 |
| 3. 標籤管理 | 能夠增加或修改會員標籤、廣告訊息的互動標籤，且一個會員可擁有複數個標籤 |
| 4. 訊息紀錄 | 確保訊息為最新狀態，可查看會員的聊天記錄，可選擇由人工進行處理，可回覆純文字、圖片或圖文訊息模板等方式，並可排程發送，並支援內部註記 |

#### User Stories

| 編號 | 名稱 | Story |
|------|------|-------|
| S_MM_001 | 會員管理 | 作為一位行銷人員，我希望系統能夠整合 LINE 官方帳號的會員，並抓取會員的基本資料、互動紀錄，以便掌握會員資訊，能規劃不同推播訊息來提升會員的忠誠度 |
| S_MM_002 | 搜尋與篩選 | 作為一位使用者，我希望能夠以搜尋或篩選，找到目標會員來進行溝通等操作，節省管理時間並提升執行效率 |
| S_MM_003 | 標籤管理 | 作為一位使用者，當回覆會員訊息時，能即時查看會員喜好（標籤）並快速為會員新增或修改標籤，以便即時更新會員資料來提升會員管理效率 |
| S_MM_004 | 訊息紀錄 | 作為一位使用者，我希望看到會員最新的互動紀錄，並即時確認是否已回覆、確保會員的問題有解決，藉此蒐集更多用戶的洞察來提升會員經營 |

#### 驗收標準（AC）

##### S_MM_001：會員管理

- ✅ 以清單形式顯示會員清單：LINE 會員頭像＋名稱、姓名、電子信箱、手機號碼、標籤（會員＋互動）、建立時間、最後回覆日期
- ✅ 點擊動作查看，可以查看會員的詳細資料，欄位如：LINE 會員頭像＋名稱、姓名、性別、生日、電子信箱、手機號碼、身分證/護照號碼（唯一值）、加入來源（LINE / CRM / 系統）、建立時間、最後回覆日期、LINE UID、標籤（會員＋互動）
- ✅ 點擊動作聊天，可以進到與該會員的一對一聊天訊息紀錄
- ✅ 若有串接 CRM，則可查看該會員的消費紀錄，如：消費時間、金額、房型或套餐，找出消費頻率（v0.2）
- ✅ 顯示會員的建立時間與紀錄最後回覆訊息的日期
- ✅ 內部人員可增加備註，註記該會員的消費習慣與喜好

##### S_MM_002：搜尋與篩選

- ✅ 可以 LINE 名稱、姓名、電子信箱、手機號碼進行搜索
- ✅ 可以會員標籤、性別、建立來源（LINE 官方帳號 / CRM / 後台系統）進行篩選
- ✅ 可以最近回覆的日期排序，找出最近聊天的會員進行回覆

##### S_MM_003：標籤管理

- ✅ 會員標籤：標籤來源為 API 抓取或自訂。查看詳細資料時，可新增或刪除會員標籤，如：生日、年齡、地區、性別、會員等級等
- ✅ 互動標籤：標籤來源為系統新增或自訂。查看詳細資料時，可新增或刪除互動標籤，如：點擊圖文訊息、圖文選單、廣告互動所貼上的標籤

##### S_MM_004：訊息紀錄

- ✅ 可與該會員進行一對一的訊息聊天記錄，顯示 LINE 會員頭像＋名稱，並且註記會員與內部雙方每一筆的聊天記錄、傳送時間、開啟對話的日期，訊息為即時更新
- ✅ 可以用純文字的方式向會員發送訊息，並且可排程日期、時間進行人工發送
- ✅ 可識別訊息回覆，為人工發送還是自動回應（人工回覆：顯示帳號名稱 / 訊息推播 / 自動回應）
- ✅ 可部分檢視該會員的基本資訊，如：姓名、性別、生日、電子信箱、手機號碼、身分證/護照號碼，且可編輯備註
- ✅ 可檢視該會員標籤：會員標籤＋互動標籤，且可新增或刪除

---

## 附錄

### 關鍵術語定義

| 術語 | 定義 |
|------|------|
| **LineOA** | LINE Official Account，LINE 官方帳號 |
| **PMS** | Property Management System，飯店管理系統（德安系統） |
| **CRM** | Customer Relationship Management，客戶關係管理 |
| **會員標籤** | 基於會員基本屬性的標籤（如：性別、年齡、地區） |
| **活動標籤** | 基於會員互動行為的標籤（如：點擊特定活動、圖文訊息） |
| **SaaS** | Software as a Service，軟體即服務 |
| **開啟次數** | 訊息被打開已讀的不重複次數 |
| **點擊次數** | 訊息中觸發互動按鈕、連結的不重複次數 |

### 技術約束與考量

1. **資料同步**：與德安 PMS 系統的資料同步機制需確保即時性與準確性
2. **LINE API 限制**：需遵守 LINE Messaging API 的訊息配額與推播限制
3. **多租戶隔離**：SaaS 架構下需確保不同飯店客戶的資料完全隔離
4. **效能要求**：支援大量訊息推播時的系統效能與穩定性
5. **圖片處理**：圖片上傳需支援自動調整比例（1:1）與壓縮（≤ 1MB）
