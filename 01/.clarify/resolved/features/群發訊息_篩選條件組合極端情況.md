# 釐清問題

群發訊息的篩選條件組合邏輯缺乏極端情況的測試，特別是空條件、全包含、全排除的處理策略

# 定位

Feature: 群發訊息 (create_broadcast.feature)
Rule: 篩選條件組合邏輯

# 多選題

| 選項 | 描述 |
|--------|-------------|
| A | include 與 exclude 皆為空時，視為「所有好友」並發送給全部會員 |
| B | include 為空但 exclude 有值時，發送給「所有好友 - 排除標籤」的會員 |
| C | include 有值但 exclude 為空時，發送給「包含所有 include 標籤」的會員 |
| D | include 與 exclude 包含相同標籤時（如：都有「VIP」），系統拒絕儲存並提示衝突 |
| E | 篩選條件導致目標對象為 0 人時，系統警告但允許繼續排程（可能是合理情境） |
| Short | 提供其他簡短答案(<=5 字) |

# 影響範圍

影響範圍：
1. create_broadcast.feature 需補充極端情況 Examples
2. 群發訊息篩選邏輯需實作條件驗證
3. estimated_send_count 計算邏輯需處理所有組合
4. 前端 UI 需顯示篩選結果預覽與警告

# 優先級

High

理由：
- 業務影響：篩選邏輯錯誤會導致訊息發送給錯誤對象
- 使用者體驗：極端情況處理影響功能可用性
- 測試完整性：需覆蓋所有可能的條件組合

---

# 解決記錄

- **回答**：include 與 exclude 由前端切換開關互斥，使用者只能擇一模式；UI 也要求至少有一種模式，避免同時為空或同時存在。
- **更新的規格檔**：`spec/features/create_broadcast.feature`, `spec/erm.dbml`
- **變更內容**：
  1. 群發 Feature 新增 Rule 說明 include/exclude 模式互斥及前端驗證流程。
  2. `Message.target_filter` 欄位 note 改成只允許單一模式的 JSON 結構，並提供新的範例。
- **業務影響**：
  - 產品邏輯和 UI 互相約束，避免產出無法預期的篩選條件，降低訊息誤發風險。
  - `estimated_send_count` 與後端過濾演算法可以簡化為單一模式，測試覆蓋更聚焦。
