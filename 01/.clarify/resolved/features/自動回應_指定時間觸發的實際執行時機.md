# 釐清問題

指定時間觸發的自動回應，實際執行時機為何？是會員發送訊息時判斷時間範圍，還是定時任務主動推播？

# 定位

Feature：spec/features/auto_response.feature Rule 關於指定時間觸發（約第49-68行）

# 多選題

| 選項 | 描述 |
|--------|-------------|
| A | 會員發送訊息時，系統判斷當前時間是否在設定範圍內，符合則回應 |
| B | 系統定時任務於設定時間範圍「開始時」主動推播給所有會員 |
| C | 混合模式：範圍內會員發訊息觸發 + 範圍開始時主動推播 |
| Short | 其他邏輯（<=5字）|

# 影響範圍

影響自動回應觸發邏輯、排程任務設計、訊息配額消耗、會員體驗，以及系統負載評估。

# 優先級

High

---
# 解決記錄

- **回答**：C - 混合模式：支援被動回應模式 + 主動推播模式
- **更新的規格檔**：spec/erm.dbml、spec/features/auto_response.feature
- **變更內容**：
  1. 在 AutoResponse 表格新增 scheduled_mode 欄位，用於區分兩種模式
  2. 在 auto_response.feature 新增 3 個 Rule，包含 6 個 Example：
     - Rule: 指定時間觸發支援兩種模式（2 個 Example）
     - Rule: 被動回應模式的執行邏輯（2 個 Example）
     - Rule: 主動推播模式的執行邏輯（2 個 Example）
- **兩種模式說明**：
  - **被動回應模式**：
    - 執行時機：會員發送訊息時，系統判斷當前時間是否在設定範圍內
    - 回應條件：時間在範圍內則回應，範圍外不回應
    - 配額消耗：僅消耗實際回應數
    - 典型應用：非營業時間自動回覆、假日自動回覆
  - **主動推播模式**：
    - 執行時機：系統於時間範圍開始時主動推播
    - 推播對象：所有會員
    - 配額消耗：一次推播消耗所有會員配額
    - 典型應用：活動開始推播、定時優惠通知
    - 記錄資訊：推播時間、推播人數
- **設計理由**：
  - **功能完整性**：兩種模式滿足不同業務需求
  - **彈性應用**：管理員可根據情境選擇適合的模式
  - **配額控制**：被動模式節省配額，主動模式確保送達率
