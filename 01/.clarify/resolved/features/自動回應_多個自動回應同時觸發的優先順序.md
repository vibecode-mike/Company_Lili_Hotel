# 釐清問題
當會員發送的訊息同時符合多個自動回應規則時，系統應該回應哪一則？是全部回應還是僅回應一則？如果僅回應一則，優先順序如何判定？

# 定位
Feature：`auto_response.feature` 未定義多個規則同時觸發時的優先順序邏輯

依據 `auto_response.feature`，系統支援關鍵字匹配、時間區間觸發等多種自動回應規則，但未明確說明多個規則同時觸發時的行為。

相關規則：
- `auto_response.feature:8-18` - 關鍵字精確匹配自動回應
- `auto_response.feature:20-29` - 關鍵字模糊匹配自動回應
- `auto_response.feature:31-43` - 設定多個關鍵字觸發同一自動回應
- `auto_response.feature:72-83` - 時間區間觸發（凌晨12點-早上9點）

潛在衝突情境：
1. 規則 A：關鍵字「預訂」→ 回應「請問您要預訂哪種房型？」
2. 規則 B：關鍵字「雙人房」→ 回應「雙人房價格為 3000 元」
3. 規則 C：時間區間「00:00-09:00」→ 回應「營業時間為 09:00-22:00」
4. 會員在凌晨 2 點發送「我要預訂雙人房」

此訊息同時符合規則 A、B、C，系統應該如何回應？

# 多選題
| 選項 | 描述 |
|--------|-------------|
| A | 觸發所有符合的自動回應，依建立時間順序逐一發送 |
| B | 僅觸發優先級最高的一則自動回應，需在 AutoResponse 實體新增 priority 欄位 |
| C | 僅觸發最近建立的一則自動回應（created_at 最晚者） |
| D | 精確匹配 > 模糊匹配 > 時間觸發，同級別規則取 priority 最高者 |
| E | 由管理員在建立自動回應時設定「是否允許與其他規則同時觸發」 |
| F | 其他方案（請說明） |

# 影響範圍
- **實體影響**：
  - AutoResponse 可能需新增 priority 欄位（若選擇 B, D）
  - AutoResponse 可能需新增 allow_concurrent 欄位（若選擇 E）
- **功能影響**：
  - 自動回應觸發邏輯的核心演算法
  - 自動回應規則建立 UI（需支援優先級設定）
  - 自動回應測試與驗證機制
- **API 影響**：
  - POST /auto-responses 需支援 priority 或 allow_concurrent 欄位
  - 自動回應觸發 API 需實作優先級過濾邏輯
- **UX 影響**：
  - 會員收到的自動回應數量與順序
  - 管理員需理解優先級規則以正確配置
- **測試影響**：需新增多規則同時觸發的測試案例

# 優先級
High

# 理由
此問題直接影響自動回應的核心邏輯與會員體驗，是功能設計的關鍵決策點，必須在實作前明確定義。若處理不當，可能導致會員收到大量重複或衝突的訊息，嚴重影響使用者體驗。

---
# 解決記錄

- **回答**：C - 僅觸發最近建立的一則自動回應（created_at 最晚者）
- **更新的規格檔**：spec/features/auto_response.feature
- **變更內容**：新增規則「多個自動回應同時觸發時，僅觸發最近建立的一則」，並提供三個 Example：(1) 多個關鍵字規則同時符合、(2) 關鍵字與時間觸發同時符合、(3) 僅有一個規則符合時正常觸發
