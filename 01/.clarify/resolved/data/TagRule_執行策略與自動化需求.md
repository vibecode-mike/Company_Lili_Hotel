# 釐清問題

ERM 中 `TagRule` 的 Note 同時出現「採用手動執行策略」及「排程任務定期讀取 TagRule 表並執行規則」兩段敘述，與 `spec/features/tag_rule_management.feature`（強調管理員手動點擊「執行規則」）互相矛盾。需要明確：TagRule 是否會由排程或背景 worker 自動執行？若沒有自動化，是否需要保留日後擴充的欄位 / log？

# 定位

- `spec/erm.dbml` → Table `TagRule` Note
- `spec/features/tag_rule_management.feature` → Rule「標籤規則採用手動執行策略，不自動執行」

# 多選題

| 選項 | 描述 |
| --- | --- |
| A | 完全手動：僅提供「執行規則」按鈕與 last_executed_at 記錄；無任何排程或背景 worker |
| B | 混合：平時手動，另有每日排程自動執行所有啟用規則 |
| C | 全自動：規則啟用後即由排程週期性執行，不提供手動入口 |
| D | 後台可選：每條規則可設定「自動/手動」，並各自排程 |
| Short | 其他 |

# 影響範圍

1. 後端是否需要實作排程、工作佇列與權限控管。
2. `TagRule` 的 `last_executed_at` 與可能的 `last_executed_by` 欄位定義。
3. 後台 UX 文案（是否需要顯示排程狀態、下次執行時間）。
4. 審計與日誌需求：自動化代表要記錄 worker 身份；手動則需記錄操作人。

# 優先級

High：若沒有統一決策，規格與前端流程會衝突，導致實作不一致。

---

# 解決記錄

- **回答**：選擇 A。v0 僅提供手動執行；沒有任何排程或背景 worker。`last_executed_at` 紀錄管理員按鈕操作時間，並在審計 log 中記錄操作者。未來若要自動化，另開版本規劃。
- **更新的規格檔**：`spec/erm.dbml`
- **變更內容**：
  1. `TagRule` Note 移除「排程任務」敘述，改為明確說明僅手動執行與 `last_executed_at` 用途。
  2. 補充「執行紀錄需寫入審計 log（操作人、規則、影響會員數）」。
- **業務影響**：
  - 營運需透過後台按鈕觸發規則，並自行安排執行頻率。
  - 平台不需部署額外排程或背景工作，降低初期維運複雜度。
