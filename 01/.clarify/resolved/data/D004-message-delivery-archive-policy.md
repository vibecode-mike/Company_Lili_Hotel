# D004: MessageDeliveryArchive 歸檔策略

## 問題描述
ERM 定義了 `MessageDeliveryArchive` 表用於歷史訊息歸檔，但未說明歸檔觸發條件與時機。

## 相關規格
- ERM: `MessageDelivery` 表 - 即時發送紀錄
- ERM: `MessageDeliveryArchive` 表 - 歷史歸檔

## 需要確認的參數
1. 歸檔觸發條件（時間? 數量?）
2. 歸檔後原始資料是否刪除
3. 歸檔資料保留期限
4. 查詢歷史紀錄時的回退邏輯

## 影響範圍
- 資料庫效能
- 訊息歷史查詢
- 儲存空間管理

## 選項
- [ ] A. 時間歸檔 - 超過 30 天的紀錄移至 Archive
- [ ] B. 狀態歸檔 - 已讀/已完成的紀錄移至 Archive
- [ ] C. 數量歸檔 - 單一 Message 超過 10000 筆時歸檔
- [ ] D. 混合策略 - 時間 + 狀態綜合判斷

## 優先級
**Low** - 影響長期運維，非初期必要

---
# 解決記錄

- **回答**：A（時間歸檔） - 主表僅保留 90 天，每日 02:00 批次搬移（建議 5,000 筆/批），成功後刪除主表資料並記錄搬移筆數/耗時/錯誤
- **更新的規格檔**：01/spec/erm.dbml（已有策略描述，無需新增）
- **變更內容**：採用既有規格：90 天後搬移至 MessageDeliveryArchive，批次搬移成功後刪除主表資料並保留 archived_at 記錄
