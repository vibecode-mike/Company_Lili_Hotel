# 釐清問題
資料模型中標註為「時間格式」的欄位（如 last_interaction_at, created_at, updated_at）應使用 string 還是 timestamp 資料型別？

# 定位
ERM：時間相關欄位的資料型別定義不一致

`erm.dbml` 中多個時間相關欄位定義為 `string` 型別，並在註解中說明格式（如 ISO 8601），但未明確說明是否應使用資料庫原生的 timestamp/datetime 型別。

典型案例：
- Member.last_interaction_at: string [note: '最後回覆日期...']
- Member.created_at: string [note: '建立時間，格式：ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ)']
- Campaign.scheduled_at: string [note: '排程發送時間，格式：ISO 8601...']
- AutoResponse.effective_from: string [note: '生效起始時間，格式：ISO 8601...']

相關 Feature：
- `member_search_filter.feature:201-214` - 按最近回覆日期排序
- `create_broadcast.feature` - 定時群發訊息功能，需要精確時間比較

# 多選題
| 選項 | 描述 |
|--------|-------------|
| A | 使用資料庫原生 timestamp 型別，後端負責 ISO 8601 格式轉換 |
| B | 保持 string 型別，格式統一為 ISO 8601，應用層負責時間運算 |
| C | 使用 bigint 儲存 Unix timestamp (毫秒)，提升查詢與排序效能 |
| D | 混合使用：created_at/updated_at 使用 timestamp，業務時間欄位使用 string |
| E | 其他方案（請說明） |

# 影響範圍
- **實體影響**：
  - Member (last_interaction_at, created_at, updated_at)
  - Campaign (scheduled_at, created_at, updated_at)
  - Message (scheduled_at, sent_at, created_at)
  - AutoResponse (effective_from, effective_until, created_at, updated_at)
  - 所有包含時間欄位的實體
- **功能影響**：
  - 時間範圍篩選功能
  - 排序功能（按時間排序）
  - 定時任務排程邏輯
  - 時區處理邏輯
- **API 影響**：
  - 所有 API 回應的時間欄位格式
  - 前端與後端的時間格式約定
- **資料庫影響**：
  - 時間欄位的索引效能
  - 時間比較查詢的效能
- **測試影響**：需新增時間格式驗證與時區轉換測試

# 優先級
Medium

# 理由
時間資料型別選擇影響查詢效能、時區處理邏輯及 API 設計，應在資料庫 schema 定義階段明確規範，避免後續遷移成本。

---
# 解決記錄

- **回答**：A - 使用資料庫原生 timestamp 型別，後端負責 ISO 8601 格式轉換
- **更新的規格檔**：spec/erm.dbml
- **變更內容**：將所有時間相關欄位從 `string` 型別改為 `timestamp` 或 `date` 型別。具體變更：
  - timestamp 型別欄位：統一儲存 UTC 時間，API 回傳時轉換為 ISO 8601 格式字串（如：2025-01-15T10:30:00Z），前端顯示時轉換為台灣時區（UTC+8）
  - date 型別欄位：儲存日期資料，格式為 yyyy-mm-dd
  - 更新的欄位包括：
    - Member: created_at, last_interaction_at
    - MemberTag: last_triggered_at
    - TagRule: created_at, updated_at
    - InteractionTag: last_triggered_at
    - MemberInteractionRecord: triggered_at
    - Message: send_time, scheduled_datetime_utc
    - MessageTemplate: created_at, updated_at
    - MessageRecord: send_time, conversation_date, scheduled_date, scheduled_time
    - AutoResponse: created_at
    - AutoResponseKeyword: last_triggered_at, created_at
    - AutoResponseMessage: created_at
    - ConsumptionRecord: consumption_time
    - Campaign: campaign_date
    - PMS_Integration: last_sync_at, created_at
    - Admin: created_at
    - Role: created_at, updated_at
    - Permission: created_at
    - AdminRole: assigned_at
    - RolePermission: granted_at
    - LineOAConfig: created_at, updated_at
    - LoginConfig: created_at, updated_at
    - LoginSession: login_time, expire_time
    - SystemAuthorization: expire_date, created_at
