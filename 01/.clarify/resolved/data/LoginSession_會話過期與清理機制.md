# 釐清問題

LoginSession 表用於追蹤管理員登入會話，但未明確定義會話過期時間、自動登出機制與過期會話清理策略

# 定位

ERM: LoginSession 表
未明確定義會話有效期限與清理邏輯

# 多選題

| 選項 | 描述 |
|--------|-------------|
| A | 會話有效期 24 小時，過期後自動登出（符合安全性要求） |
| B | 會話有效期 7 天，支援「記住我」功能延長至 30 天 |
| C | 會話無固定期限，僅在明確登出時失效（適用於內部系統） |
| D | 每日自動清理 30 天前的過期會話記錄（資料庫空間管理） |
| E | 會話閒置超過 2 小時自動登出（安全性與便利性平衡） |
| Short | 提供其他簡短答案(<=5 字) |

# 影響範圍

影響範圍：
1. LoginSession 表需新增 expires_at、last_activity_at 欄位
2. 登入 API 需實作會話過期檢查邏輯
3. 前端需處理會話過期自動跳轉登入頁
4. 排程任務自動清理過期會話記錄

# 優先級

High

理由：
- 安全性需求：會話管理直接影響系統安全性
- 使用者體驗：需平衡安全性與便利性
- 資料庫效能：過期會話累積會影響查詢效能

---

# 解決記錄

- **回答**：選擇 A。每筆 LoginSession 僅記錄登入驗證，會話有效期為 `min(登入時間 + 24 小時, 下一個 UTC+8 00:00)`，逾期後僅標記 is_active = false。歷史登入紀錄保留於資料庫，不執行排程刪除或閒置檢查。
- **更新的規格檔**：`spec/erm.dbml`
- **變更內容**：
  1. 擴寫 LoginSession Note，強調過期判定方式只在 API 驗證時檢查，不提供「記住我」或閒置自動登出。
  2. 新增資料保留說明：過期/登出的會話僅更新狀態，不清理紀錄，以利稽核。
- **業務影響**：
  - 安全性透過固定 24 小時與跨日失效機制維持，無需額外閒置追蹤。
  - 登入歷程完整保留，方便稽核或疑難排解，不會因排程清理遺失。
