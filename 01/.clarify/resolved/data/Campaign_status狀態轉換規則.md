# 釐清問題

Campaign.status 的狀態轉換規則為何？哪些狀態可以互相轉換？轉換的觸發條件為何？

# 定位

ERM：spec/erm.dbml Campaign 表格 status 欄位（約第100行）
Feature：spec/features/message_analytics.feature Rule 關於訊息狀態（約第55-102行）

# 多選題

| 選項 | 描述 |
|--------|-------------|
| A | 草稿 → 排程發送 → 已發送；已發送 → 發送失敗（單向流程） |
| B | 草稿 ↔ 排程發送 ↔ 已發送；發送失敗可重試回到排程（可逆） |
| C | 需要完整狀態機圖，包含取消、暫停等中間狀態 |
| Short | 提供狀態機圖（<=5字）|

# 影響範圍

影響群發訊息編輯權限、排程任務管理、失敗重試機制、狀態變更日誌，以及前端 UI 按鈕顯示邏輯。

# 優先級

High

---
# 解決記錄

- **回答**：修改版 - 發送失敗後允許改回草稿
- **更新的規格檔**：spec/erm.dbml
- **變更內容**：
  1. 更新 Message.send_status 欄位 note，明確狀態轉換規則
  2. 更新 Message 表格 Note，詳細說明狀態機邏輯
- **狀態機圖**：
  ```
  草稿 ←→ 排程發送 → 已發送 ✅（終止）
    ↑          ↓
    └──── 發送失敗（可修改後重試）
  ```
- **狀態轉換規則**：
  - **草稿 ⇄ 排程發送**：雙向轉換（允許取消排程）
  - **排程發送 → 已發送**：成功發送後進入終止狀態，不可變更（防止重複發送）
  - **排程發送 → 發送失敗**：發送過程中失敗（如：額度不足、API 錯誤）
  - **發送失敗 → 草稿**：允許修正問題後改回草稿，重新編輯並排程
- **終止狀態**：已發送（不可逆）
- **可重試狀態**：發送失敗（可改回草稿）
- **業務價值**：
  - **提升彈性**：額度不足、API 錯誤等可恢復的失敗，允許重試
  - **優化體驗**：不需要重新建立訊息，修正問題後即可重新發送
  - **保護機制**：已成功發送的訊息仍然不可逆，防止重複發送給會員
