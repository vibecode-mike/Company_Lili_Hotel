# 釐清問題

當同一事件同時符合多個自動回應規則（例如：會員在非營業時間發送「訂房」，同時命中指定時間觸發與關鍵字觸發），系統是否要回覆多則訊息？或需定義優先順序只回覆一組？

# 定位

- `spec/features/auto_response.feature`：僅描述各觸發類型，未定義衝突處理。
- `erm.dbml` 的 AutoResponse 區段亦未提及優先權或節流。

# 多選題

| 選項 | 描述 |
| --- | --- |
| A | 不限制，所有符合的規則都依序發送（可能一次多則訊息） |
| B | 限制單次事件僅觸發一條規則，依固定優先序（例如：關鍵字 > 指定時間 > 歡迎訊息） |
| C | 允許手動設定每條規則的優先權數值，依數值排序 |
| D | 允許最多 2 條（系統預設上限），並採 FIFO |
| Short | 其他 |

# 影響範圍

1. 事件處理流程需判斷優先權，避免一次多條訊息造成體驗不佳或超過 LINE 限制。
2. 後台需向使用者說明優先順序，避免錯誤期待。
3. 若採單一回應模式，需記錄「被略過」的規則以供營運調整策略。

# 優先級

High：未定義會導致實作歧異，且多則訊息可能被視為騷擾。

---

# 解決記錄

- **回答**：選擇 B。單一事件僅回覆一條自動回應；系統固定優先順序：關鍵字觸發 > 指定時間觸發 > 歡迎訊息（僅 Follow event）。若同一層有多條符合，取建立時間最早的一條。其餘符合條件的規則記錄在 log 供分析，但不發送訊息。
- **更新的規格檔**：`spec/features/auto_response.feature`
- **變更內容**：
  1. 新增 Rule「觸發衝突優先順序」，列出優先序與僅發送一條訊息的行為。
  2. 在 Example 中說明關鍵字與指定時間同時符合時僅回覆關鍵字訊息。
- **業務影響**：
  - 避免對會員連續推播多則訊息造成困擾。
  - 營運可透過 log 查看被略過的規則，調整條件或複製內容。
