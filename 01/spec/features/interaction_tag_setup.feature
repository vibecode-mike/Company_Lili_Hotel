Feature: 互動標籤設定
  作為一位行銷人員
  我希望在設定訊息群發時能綁定互動標籤，在會員點擊廣告互動時，自動於會員資料中新增該標籤
  以利後續分析活動成效與找出興趣受眾

  Rule: 互動標籤來源支援透過訊息模板設定的廣告互動標籤

    Example: 訊息模板設定廣告互動標籤
      Given 行銷人員建立訊息模板並設定互動標籤「檔期優惠」
      When 會員「陳一」點擊該訊息
      Then 系統為會員「陳一」新增互動標籤「檔期優惠」

  Rule: 互動標籤來源支援會員互動的模板類型

    Example: 會員互動訊息圖文模板自動貼標
      Given 行銷人員建立圖片點擊型模板並設定互動標籤「雙十活動」
      When 會員「林二」點擊該圖片
      Then 系統為會員「林二」新增互動標籤「雙十活動」

    Example: 會員互動問券模板自動貼標
      Given 行銷人員建立問券模板並設定互動標籤「滿意度調查」
      When 會員「黃三」完成問券
      Then 系統為會員「黃三」新增互動標籤「滿意度調查」

  Rule: 可編輯既有的互動標籤

    Example: 編輯互動標籤
      Given 系統中存在互動標籤「早鳥優惠」
      When 行銷人員將標籤「早鳥優惠」編輯為「早鳥專案」
      Then 標籤名稱更新為「早鳥專案」

  Rule: 刪除互動標籤時二次確認彈窗

    Example: 刪除互動標籤時彈窗確認
      Given 系統中存在互動標籤「過期活動」
      When 行銷人員刪除標籤「過期活動」
      Then 系統彈窗確認是否刪除

  Rule: 於群發訊息設定頁可手動輸入新標籤

    Example: 手動新增互動標籤
      Given 行銷人員正在建立群發訊息
      When 行銷人員手動輸入新標籤「週年慶」
      Then 系統新增互動標籤「週年慶」

  Rule: 手動新增互動標籤時自動排除重複標籤

    Example: 手動新增重複互動標籤時操作失敗
      Given 系統中存在互動標籤「雙十優惠」
      When 行銷人員手動輸入新標籤「雙十優惠」
      Then 操作失敗

  Rule: 新增互動標籤後即時反映於標籤管理頁

    Example: 新增互動標籤後標籤管理頁立即更新
      Given 行銷人員在群發訊息設定頁手動新增互動標籤「週年慶」
      When 標籤新增成功
      Then 標籤管理頁立即顯示新標籤「週年慶」，無需手動刷新頁面

  Rule: 互動標籤名稱格式限制：長度不得超過 20 字元，僅允許中英文、數字、空格

    Example: 新增互動標籤名稱超過 20 個字時操作失敗
      Given 行銷人員正在建立群發訊息
      When 行銷人員手動輸入新標籤「超過二十個中文字元的標籤名稱測試超過二十個中文字元的標籤名稱測試」
      Then 操作失敗
      And 系統顯示錯誤訊息「標籤名稱不得超過 20 字元」

    Example: 新增包含允許字元的互動標籤成功
      Given 行銷人員正在建立群發訊息
      When 行銷人員手動輸入新標籤「VIP 會員」
      Then 標籤新增成功
      And 系統接受中文、英文、數字和空格

    Example: 新增包含允許字元的互動標籤成功（數字+空格）
      Given 行銷人員正在建立群發訊息
      When 行銷人員手動輸入新標籤「2024 春節優惠」
      Then 標籤新增成功

    Example: 新增包含特殊字元的互動標籤失敗
      Given 行銷人員正在建立群發訊息
      When 行銷人員手動輸入新標籤「VIP,優惠」
      Then 操作失敗
      And 系統顯示錯誤訊息「標籤名稱僅允許中文、英文、數字和空格」

    Example: 新增包含 Emoji 的互動標籤失敗
      Given 行銷人員正在建立群發訊息
      When 行銷人員手動輸入新標籤「優惠🎉」
      Then 操作失敗
      And 系統顯示錯誤訊息「標籤名稱僅允許中文、英文、數字和空格」

    Example: 新增包含標點符號的互動標籤失敗
      Given 行銷人員正在建立群發訊息
      When 行銷人員手動輸入新標籤「雙十！特惠」
      Then 操作失敗
      And 系統顯示錯誤訊息「標籤名稱僅允許中文、英文、數字和空格」

  Rule: 若同一會員重複點擊相同互動訊息，系統僅記錄一次貼標

    Example: 重複點擊相同互動訊息僅記錄一次貼標
      Given 會員「周四」已點擊訊息並獲得互動標籤「新春優惠」
      When 會員「周四」再次點擊相同訊息
      Then 會員「周四」的互動標籤「新春優惠」觸發次數不增加

  Rule: 當會員點擊訊息內的互動按鈕（文字按鈕），系統自動將該標籤加入該會員資料

    Example: 點擊文字按鈕自動貼標
      Given 訊息模板設定互動標籤「立即訂房」
      And 該模板包含文字按鈕「馬上預訂」
      When 會員「吳五」點擊文字按鈕「馬上預訂」
      Then 系統為會員「吳五」新增互動標籤「立即訂房」

  Rule: 當會員點擊訊息內的互動按鈕（圖片），系統自動將該標籤加入該會員資料

    Example: 點擊圖片自動貼標
      Given 訊息模板設定互動標籤「親子旅遊」
      And 該模板為圖片點擊型
      When 會員「鄭六」點擊圖片
      Then 系統為會員「鄭六」新增互動標籤「親子旅遊」

  Rule: 當會員點擊訊息內的互動按鈕（圖卡按鈕），系統自動將該標籤加入該會員資料

    Example: 點擊圖卡按鈕自動貼標
      Given 訊息模板設定互動標籤「商務優惠」
      And 該模板為圖卡按鈕型，包含按鈕「查看詳情」
      When 會員「王七」點擊圖卡按鈕「查看詳情」
      Then 系統為會員「王七」新增互動標籤「商務優惠」

  Rule: 訊息模板支援設定多個互動標籤，由標籤觸發模式決定記錄邏輯

    Example: 設定多個互動標籤且選擇全部觸發模式
      Given 行銷人員建立訊息模板並設定互動標籤「雙十,檔期優惠」
      And 標籤觸發模式選擇「全部觸發」
      When 會員「張三」點擊該訊息
      Then 系統為會員「張三」新增互動標籤「雙十」
      And 系統為會員「張三」新增互動標籤「檔期優惠」
      And 兩個標籤的 trigger_count 分別累加

    Example: 設定多個互動標籤且選擇僅主標籤模式
      Given 行銷人員建立訊息模板並設定互動標籤「雙十,檔期優惠」
      And 標籤觸發模式選擇「僅主標籤」
      When 會員「李四」點擊該訊息
      Then 系統為會員「李四」新增互動標籤「雙十」
      And 系統不記錄標籤「檔期優惠」
