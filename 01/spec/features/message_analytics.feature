Feature: 訊息數據成效
  作為一位行銷數據人員
  我希望系統存取所有已發訊息的歷史成效數據
  以利分析用戶對內容與互動的偏好，來為下個季度做行銷的優化與調整

  Rule: 以清單形式顯示訊息發送清單，包含縮圖

    Example: 訊息清單顯示縮圖
      Given 系統中存在訊息「雙人房優惠」，縮圖為「room.jpg」
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「雙人房優惠」的縮圖「room.jpg」

  Rule: 以清單形式顯示訊息發送清單，無圖片則為系統預設圖

    Example: 訊息無縮圖時顯示預設圖
      Given 系統中存在訊息「純文字通知」，無縮圖
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「純文字通知」的縮圖為系統預設圖

  Rule: 以清單形式顯示訊息發送清單，包含傳送時間

    Example: 訊息清單顯示傳送時間
      Given 系統中存在訊息「週末優惠」，傳送時間為「2025/01/20 10:00」
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「週末優惠」的傳送時間「2025/01/20 10:00」

  Rule: 以清單形式顯示訊息發送清單，包含傳送人數

    Example: 訊息清單顯示傳送人數
      Given 系統中存在訊息「新春活動」，傳送人數為 500 人
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「新春活動」的傳送人數「500」

  Rule: 以清單形式顯示訊息發送清單，包含部分訊息內容

    Example: 訊息清單顯示部分訊息內容
      Given 系統中存在訊息「春節優惠」，訊息內容為「春節期間住宿享 8 折優惠，名額有限...」
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「春節優惠」的部分內容

  Rule: 以清單形式顯示訊息發送清單，包含開啟次數（會員已讀訊息的不重複人數）

    Example: 訊息清單顯示開啟次數
      Given 系統中存在訊息「VIP 專屬」，已傳送給 500 位會員
      And 其中 320 位不重複會員已讀該訊息
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「VIP 專屬」的開啟次數「320」
      And 開啟次數計算邏輯為「COUNT(DISTINCT member_id WHERE 已讀)」

    Example: 同一會員多次開啟僅計算一次
      Given 系統中存在訊息「週末優惠」
      And 會員「張三」開啟該訊息 3 次
      And 會員「李四」開啟該訊息 1 次
      When 系統計算開啟次數
      Then 開啟次數為「2」（不重複會員數）

  Rule: 以清單形式顯示訊息發送清單，包含點擊次數（點擊按鈕/連結的不重複人數）

    Example: 訊息清單顯示點擊次數
      Given 系統中存在訊息「早鳥優惠」，已傳送給 500 位會員
      And 其中 150 位不重複會員點擊了按鈕或連結
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「早鳥優惠」的點擊次數「150」
      And 點擊次數計算邏輯為「COUNT(DISTINCT member_id WHERE 點擊互動)」

    Example: 同一會員多次點擊僅計算一次
      Given 系統中存在訊息「限時促銷」
      And 會員「王五」點擊該訊息按鈕 5 次
      And 會員「趙六」點擊該訊息連結 2 次
      When 系統計算點擊次數
      Then 點擊次數為「2」（不重複會員數）

    Example: 會員開啟但未點擊不計入點擊次數
      Given 系統中存在訊息「新品上市」
      And 會員「孫七」已讀該訊息但未點擊任何按鈕或連結
      When 系統計算點擊次數
      Then 該會員不計入點擊次數

  Rule: 系統須識別訊息發送狀態：排程發送

    Example: 訊息狀態為排程發送
      Given 系統中存在訊息「週年慶」，發送狀態為「排程發送」
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「週年慶」的狀態為「排程發送」

  Rule: 排程發送狀態的訊息可編輯

    Example: 編輯排程發送的訊息
      Given 系統中存在訊息「夏日優惠」，發送狀態為「排程發送」
      When 行銷數據人員編輯訊息「夏日優惠」
      Then 系統允許編輯訊息「夏日優惠」

  Rule: 排程發送狀態的訊息可取消排程

    Example: 取消排程訊息
      Given 系統中存在訊息「春節促銷」，發送狀態為「排程發送」
      And 排程發送時間為「2025/02/01 10:00」（UTC: 2025-02-01T02:00:00Z）
      When 行銷人員點擊「取消排程」按鈕
      Then 系統將 send_status 更新為「草稿」
      And 系統保留所有訊息資料（內容、排程時間、篩選條件、模板等）
      And 系統顯示訊息「已取消排程，訊息已改為草稿狀態」

    Example: 取消後資料完整保留
      Given 系統中存在排程訊息「VIP 專屬優惠」
        | 欄位                   | 值                       |
        | message_content        | VIP 會員專屬優惠         |
        | scheduled_datetime_utc | 2025-02-01T02:00:00Z     |
        | target_filter          | {"include": ["VIP"]}     |
        | template_id            | template_123             |
      When 行銷人員取消排程
      Then 系統將 send_status 更新為「草稿」
      And 所有訊息資料保持不變
        | 欄位                   | 值                       |
        | message_content        | VIP 會員專屬優惠         |
        | scheduled_datetime_utc | 2025-02-01T02:00:00Z     |
        | target_filter          | {"include": ["VIP"]}     |
        | template_id            | template_123             |

    Example: 取消後可重新編輯並再次排程
      Given 訊息「限時優惠」已取消排程，send_status 為「草稿」
      When 行銷人員重新編輯該訊息
      And 行銷人員修改排程時間為「2025/02/05 10:00」（UTC: 2025-02-05T02:00:00Z）
      And 行銷人員點擊「發送」並選擇「排程發送」
      Then 系統將 send_status 更新為「排程發送」
      And 系統更新 scheduled_datetime_utc 為「2025-02-05T02:00:00Z」

  Rule: 已發送或草稿狀態的訊息無取消排程操作

    Example: 已發送的訊息無法取消排程
      Given 訊息「春節促銷」send_status 為「已發送」
      When 行銷人員查看該訊息
      Then 系統不顯示「取消排程」按鈕

    Example: 草稿狀態的訊息無需取消操作
      Given 訊息「草稿訊息」send_status 為「草稿」
      When 行銷人員查看該訊息
      Then 系統不顯示「取消排程」按鈕
      And 原因：草稿本身就不在排程狀態

  Rule: 系統須識別訊息發送狀態：已發送

    Example: 訊息狀態為已發送
      Given 系統中存在訊息「母親節特惠」，發送狀態為「已發送」
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「母親節特惠」的狀態為「已發送」

  Rule: 已發送狀態的訊息不可編輯

    Example: 無法編輯已發送的訊息
      Given 系統中存在訊息「端午促銷」，發送狀態為「已發送」
      When 行銷數據人員嘗試編輯訊息「端午促銷」
      Then 操作失敗

  Rule: 系統須識別訊息發送狀態：草稿

    Example: 訊息狀態為草稿
      Given 系統中存在訊息「中秋活動」，發送狀態為「草稿」
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「中秋活動」的狀態為「草稿」

  Rule: 草稿狀態的訊息可編輯

    Example: 編輯草稿訊息
      Given 系統中存在訊息「雙十活動」，發送狀態為「草稿」
      When 行銷數據人員編輯訊息「雙十活動」
      Then 系統允許編輯訊息「雙十活動」

  Rule: 系統須識別訊息發送狀態：發送失敗

    Example: 訊息狀態為發送失敗
      Given 系統中存在訊息「聖誕優惠」，發送狀態為「發送失敗」
      When 行銷數據人員查看訊息發送清單
      Then 系統顯示訊息「聖誕優惠」的狀態為「發送失敗」

  Rule: 發送失敗狀態顯示失敗原因：訊息額度不足

    Example: 顯示發送失敗原因
      Given 系統中存在訊息「跨年活動」，發送狀態為「發送失敗」
      And 失敗原因為「訊息額度不足」
      When 行銷數據人員查看訊息「跨年活動」
      Then 系統顯示失敗原因「訊息額度不足」

  Rule: 發送失敗的訊息不自動重試，提供手動重新發送功能

    Example: 發送失敗後不自動重試
      Given 系統發送訊息「週年慶」時因網路問題失敗
      When 訊息發送失敗
      Then 系統將訊息狀態標記為「發送失敗」
      And 系統記錄失敗原因「網路連線逾時」
      And 系統不自動嘗試重新發送

    Example: 管理員查看失敗訊息並手動重新發送
      Given 系統中存在訊息「會員日活動」，發送狀態為「發送失敗」
      And 失敗原因為「LINE API 暫時無回應」
      When 行銷數據人員查看該訊息
      Then 系統顯示失敗原因「LINE API 暫時無回應」
      And 系統提供「重新發送」按鈕
      When 行銷數據人員點擊「重新發送」按鈕
      Then 系統重新執行訊息發送流程
      And 系統更新訊息狀態為「發送中」

    Example: 不同失敗原因的顯示
      Given 系統中存在以下發送失敗的訊息
        | message_name | failure_reason      |
        | 優惠活動A    | 訊息額度不足        |
        | 優惠活動B    | 會員已封鎖         |
        | 優惠活動C    | 網路連線逾時        |
      When 行銷數據人員查看訊息發送清單
      Then 系統分別顯示各訊息的失敗原因
      And 所有失敗訊息都提供「重新發送」按鈕

  Rule: 支援依據訊息的傳送時間進行篩選

    Example: 依傳送時間篩選訊息
      Given 系統中存在以下訊息
        | message_name | send_time        |
        | 元旦優惠     | 2025/01/01 10:00 |
        | 春節優惠     | 2025/02/10 09:00 |
        | 清明促銷     | 2025/04/04 14:00 |
      When 行銷數據人員篩選傳送時間介於「2025/01/01」到「2025/02/28」
      Then 系統顯示以下訊息
        | message_name | send_time        |
        | 元旦優惠     | 2025/01/01 10:00 |
        | 春節優惠     | 2025/02/10 09:00 |

  Rule: 允許帶入起始時間搜索歷史訊息

    Example: 輸入起始時間篩選訊息
      Given 系統中存在以下訊息
        | message_name | send_time        |
        | 訊息A        | 2025/01/10 10:00 |
        | 訊息B        | 2025/01/20 09:00 |
        | 訊息C        | 2025/01/30 14:00 |
      When 行銷數據人員輸入起始時間「2025/01/20」
      Then 系統顯示以下訊息
        | message_name | send_time        |
        | 訊息B        | 2025/01/20 09:00 |
        | 訊息C        | 2025/01/30 14:00 |

  Rule: 允許帶入結束時間搜索歷史訊息

    Example: 輸入結束時間篩選訊息
      Given 系統中存在以下訊息
        | message_name | send_time        |
        | 訊息X        | 2025/01/10 10:00 |
        | 訊息Y        | 2025/01/20 09:00 |
        | 訊息Z        | 2025/01/30 14:00 |
      When 行銷數據人員輸入結束時間「2025/01/20」
      Then 系統顯示以下訊息
        | message_name | send_time        |
        | 訊息X        | 2025/01/10 10:00 |
        | 訊息Y        | 2025/01/20 09:00 |

  Rule: 點擊任一訊息後，可進入詳細頁面查看廣告成效趨勢（折線圖）

    Example: 查看廣告成效趨勢折線圖（雙軸顯示開啟與點擊次數）
      Given 系統中存在訊息「新春特惠」
      And 該訊息在過去 7 天的開啟次數為「50, 80, 120, 90, 110, 95, 85」
      And 該訊息在過去 7 天的點擊次數為「10, 15, 25, 18, 22, 20, 17」
      When 行銷數據人員點擊訊息「新春特惠」進入詳細頁面查看廣告成效趨勢
      Then 系統顯示折線圖，Y 軸為「開啟次數」與「點擊次數」雙軸
      And 圖表顯示兩條折線，分別代表開啟次數和點擊次數的變化趨勢

  Rule: 點擊任一訊息後，可進入詳細頁面查看發送對象清單

    Example: 查看訊息發送對象清單
      Given 系統中存在訊息「商務房優惠」
      And 發送對象包含會員「張三」「李四」「王五」
      When 行銷數據人員點擊訊息「商務房優惠」進入詳細頁面
      Then 系統顯示發送對象清單
        | member_name |
        | 張三        |
        | 李四        |
        | 王五        |

  Rule: 點擊任一訊息後，可進入詳細頁面查看完整訊息內容

    Example: 查看完整訊息內容
      Given 系統中存在訊息「親子旅遊」
      And 訊息內容為「親子旅遊套裝行程，含住宿、早餐與樂園門票，限時優惠中！」
      When 行銷數據人員點擊訊息「親子旅遊」進入詳細頁面
      Then 系統顯示完整訊息內容「親子旅遊套裝行程，含住宿、早餐與樂園門票，限時優惠中！」
