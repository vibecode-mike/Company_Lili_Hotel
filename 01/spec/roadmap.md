# Lili Hotel 專案版本路線圖

**專案名稱**: Lili Hotel LINE CRM 系統
**最後更新**: 2025-11-20
**維護者**: Lili Hotel 開發團隊

---

## 📍 版本總覽

| 版本 | 狀態 | 發布日期 | 主要目標 | 完成度 |
|------|------|---------|---------|--------|
| **v1.0** | ✅ 已完成 | 2025-11-20 | 基礎 CRM 系統 | 100% |
| **v2.0** | 📋 規劃中 | 2026-Q1 | 進階分析與優化 | 0% |
| **v3.0** | 💡 概念階段 | 2026-Q3+ | 智能化與自動化 | - |

---

## v1.0 - 基礎 CRM 系統 ✅

**發布日期**: 2025-11-20
**狀態**: 已完成（100%）
**目標**: 建立核心會員管理和 LINE 訊息發送功能

### 核心功能

#### 會員管理系統
- ✅ Member CRUD API
- ✅ LINE 整合（line_uid, line_name, line_avatar）
- ✅ 會員標籤管理（MemberTag）
- ✅ 會員搜尋和篩選
- ✅ 會員詳情頁（含 LINE 資料顯示）

#### LINE Messaging API 整合
- ✅ LINE Channel 設定
- ✅ Webhook 基礎架構
- ✅ 訊息發送 API（單筆/批次）
- ✅ LINE 訊息配額查詢（基礎）

#### 訊息模板管理
- ✅ MessageTemplate CRUD
- ✅ Flex Message 支援
- ✅ 輪播訊息（Carousel, 2-9 張卡片）
- ✅ 按鈕管理（JSON 儲存，最多 4 個）
- ✅ 圖片上傳和裁切（1:1 比例）
- ✅ 模板庫管理
- ✅ CDN 儲存支援（flex_message_url）

#### 標籤系統
- ✅ InteractionTag 定義
- ✅ MemberTag 關聯
- ✅ 標籤觸發追蹤
- ✅ 標籤規則（TagRule）基礎架構

#### 行銷活動管理
- ✅ Campaign CRUD
- ✅ 排程發送
- ✅ 目標受眾篩選
- ✅ 發送記錄追蹤（MessageDelivery）

#### 自動回應系統
- ✅ AutoResponse 管理
- ✅ 歡迎訊息（FollowEvent 觸發）
- ✅ 關鍵字觸發（最多 20 個關鍵字）
- ✅ 時間範圍觸發（被動模式）
- ✅ 多訊息回應（1-5 則訊息）
- ✅ 觸發統計（trigger_count）

#### 問卷系統
- ✅ Survey 管理
- ✅ SurveyTemplate 模板
- ✅ SurveyQuestion 題目設計
- ✅ SurveyResponse 回應收集

#### CRM 整合
- ✅ ConsumptionRecord 消費記錄
- ✅ PMSIntegration PMS 系統整合
- ✅ stay_records JSON 儲存（臨時方案）

#### 互動追蹤
- ✅ ComponentInteractionLog 詳細追蹤
- ✅ ClickTrackingDemo 點擊追蹤示範

### v1 實作決策

**簡化設計**:
- ✅ Member 表處理 LINE 好友資料（不使用獨立 LineFriend 表）
- ✅ MessageTemplate.buttons JSON 儲存（不使用獨立 TemplateButton 表）
- ✅ 簡化 LINE API（無流量限制和重試機制）
- ✅ 無定期頭像更新排程
- ✅ TagRule 不實作自動執行器（保留模型，手動管理標籤）

**原因**: 降低系統複雜度，專注核心功能，避免過度工程化

### 技術架構

**後端**:
- FastAPI（Python 3.11+）
- SQLAlchemy ORM
- PostgreSQL 資料庫
- Alembic 資料庫遷移
- LINE Messaging API SDK

**前端**:
- React 18
- TypeScript
- Vite 建構工具
- TanStack Query（資料管理）
- Tailwind CSS + shadcn/ui

**部署**:
- Docker 容器化
- Nginx 反向代理

### v1 完成度

**整體**: 100%

**已完成**:
- ✅ 資料庫設計和遷移
- ✅ 核心 API 端點
- ✅ 前端基礎頁面
- ✅ LINE 訊息發送
- ✅ 標籤和問卷系統
- ✅ Webhook 處理器（Follow/Unfollow/Message/Postback）- 在 line_app/app.py 完整實作
- ✅ AI 客服系統（GPT-4o + 記憶功能）- 額外功能
- ✅ 配額監控系統（usage_monitor.py）- 超越 v1 規格，達到 v2 標準
- ✅ LIFF 問卷系統（完整架構）- 超越 v1 規格

**不實作項目** (簡化設計):
- ❌ TagRule 自動執行器（保留模型，v2/v3 視需求實作）
- ❌ 定期頭像更新排程（僅在互動時更新）
- ❌ LINE API 流量限制和重試機制（初期流量低）

---

## v2.0 - 進階分析與優化 📋

**預計發布**: 2026-Q1
**狀態**: 規劃中
**目標**: 增強資料分析能力和系統效能
**預估工時**: 約 4 天

### P0 核心功能（1.5 天）

#### 1. StayRecord 住房記錄表（1 天）

**目標**: 建立獨立的住房記錄管理系統

**功能**:
- 建立 StayRecord 資料表模型
- PMS 同步整合（從 JSON 遷移到獨立表）
- 支援複雜查詢和統計分析
- TagRule 整合（visit_frequency, room_type 規則）
- 住房頻率分析
- 房型偏好追蹤

**價值**:
- 精準的常客識別
- 個人化房型推薦
- 住房行為分析

---

#### 2. MessageDeliveryArchive 歸檔表（0.5 天）

**目標**: 實作訊息發送記錄歸檔機制

**功能**:
- 建立 MessageDeliveryArchive 資料表
- 90天自動歸檔排程（每日 02:00）
- 批次處理（5000 筆/批次）
- 歸檔資料查詢 API
- 歷史資料保留政策

**價值**:
- 主表效能優化（保持輕量）
- 長期資料保留
- 查詢速度提升

---

### P1 進階功能（2 天）

#### 3. 自動回應主動推播模式（1 天）

**目標**: 支援定時主動推播訊息

**功能**:
- AutoResponse 新增欄位（weekdays, scheduled_mode）
- 星期篩選功能（週一~週日多選）
- 時間點自動推播
- 24小時去重邏輯（避免重複發送）
- 配額檢查整合
- 前端推播模式設定介面

**使用情境**:
- 每週一早上 9:00 推送本週優惠
- 每月 1 號推送會員專屬活動
- 節慶前夕自動推送祝福訊息

**價值**:
- 自動化行銷
- 提升客戶互動率
- 減少人工操作

---

#### 4. 訊息配額管理完善（0.5 天）

**目標**: 完善 LINE 訊息配額監控

**功能**:
- estimated_send_count 自動計算
- 發送前配額驗證完善
- 配額不足時阻擋發送
- 前端配額監控儀表板
- 配額警告顯示（剩餘 < 10%）

**價值**:
- 避免超過 LINE 配額限制
- 即時配額監控
- 成本控制

---

#### 5. MessageTemplate 進階欄位（0.5 天）

**目標**: 支援 CDN 儲存和多標籤觸發

**功能**:
- 新增欄位：tag_trigger_mode, flex_message_size, needs_cdn_retry, upload_error_message
- CDN 自動上傳（Flex Message >= 10KB）
- CDN 重試機制（失敗自動重試）
- 多標籤觸發策略（all: 全部標籤 / primary: 主要標籤）
- 錯誤訊息記錄和追蹤

**價值**:
- 大型 Flex Message 效能優化
- 彈性的標籤觸發策略
- 錯誤追蹤和除錯

---

### P2 優化功能（0.5 天）

#### 6. LINE OA 重新設定（0.5 天）

**目標**: 支援更換 LINE 官方帳號

**功能**:
- LINE OA 解除綁定 API
- 二次確認流程（前端）
- 資料保留策略實作
- OA 重新配置支援

**價值**:
- 彈性更換 LINE OA
- 資料不遺失
- 平滑遷移

---

## v3.0 - 智能化與自動化 💡

**預計時程**: 2026-Q3+
**狀態**: 概念階段
**目標**: 導入 AI 和自動化功能

### 可能功能（待評估）

#### 進階好友管理
- 可考慮建立獨立 LineFriend 表
- is_following 精準追蹤
- 好友生命週期分析（LTV, Churn Rate）
- 封鎖/解除封鎖事件追蹤

#### AI 功能
- AI 訊息推薦系統
- 自動標籤建議引擎
- 客戶行為預測分析
- 最佳發送時間預測

#### 測試與優化
- A/B 測試系統
- 轉換率分析
- 訊息效果追蹤

#### 進階數據分析
- 進階數據分析儀表板
- 客戶分群分析（RFM）
- 行為漏斗分析
- 自訂報表生成

#### 效能優化
- LINE API 流量控制（Token Bucket，若流量增長）
- 自動重試機制（指數退避）
- 訊息佇列系統（Celery/RabbitMQ）

#### 其他整合
- Google Analytics 整合
- CRM 系統深度整合
- 多渠道訊息（Email, SMS）

---

## 📊 功能對照表

| 功能 | v1 | v2 | v3 |
|------|----|----|-----|
| **會員管理** | ✅ | ✅ | ✅ |
| **LINE 訊息發送** | ✅ | ✅ | ✅ |
| **訊息模板** | ✅ | ✅ | ✅ |
| **標籤系統** | ✅ | ✅ | ✅ |
| **行銷活動** | ✅ | ✅ | ✅ |
| **自動回應（被動）** | ✅ | ✅ | ✅ |
| **問卷系統** | ✅ | ✅ | ✅ |
| **配額查詢** | ✅ 基礎 | ✅ 完善 | ✅ |
| **住房記錄** | JSON | ✅ 獨立表 | ✅ |
| **訊息歸檔** | ❌ | ✅ | ✅ |
| **主動推播** | ❌ | ✅ | ✅ |
| **CDN 儲存** | 基礎 | ✅ 完善 | ✅ |
| **LineFriend 表** | ❌ | ❌ | 🤔 評估 |
| **AI 推薦** | ❌ | ❌ | ✅ |
| **A/B 測試** | ❌ | ❌ | ✅ |
| **進階分析** | ❌ | ❌ | ✅ |

---

## 🎯 開發里程碑

### v1.0 里程碑 ✅

- [x] 2025-09 ~ 2025-10: 資料庫設計和後端 API
- [x] 2025-10 ~ 2025-11: 前端開發
- [x] 2025-11-15: 內部測試
- [x] 2025-11-20: v1.0 發布（92% 完成）

### v2.0 里程碑 📋

- [ ] 2025-12: 需求確認和設計
- [ ] 2026-01: StayRecord + MessageDeliveryArchive 開發
- [ ] 2026-02: 主動推播 + 配額管理 + 進階欄位開發
- [ ] 2026-03: 測試和發布

### v3.0 里程碑 💡

- [ ] 2026-Q2: 需求評估和規劃
- [ ] 2026-Q3: AI 功能開發
- [ ] 2026-Q4: 測試和發布

---

## 📈 成長指標

### v1.0 目標
- 會員數：1000+
- 每月訊息發送：10,000+
- 標籤數量：50+
- 行銷活動：20+

### v2.0 目標
- 會員數：5000+
- 每月訊息發送：50,000+
- 自動推播活動：50+/月
- 住房記錄：10,000+

### v3.0 目標
- 會員數：20,000+
- 每月訊息發送：200,000+
- AI 推薦準確率：80%+
- 轉換率提升：30%+

---

## 🔧 技術債務管理

### v1 技術債務

| 項目 | 優先級 | 計劃解決版本 |
|------|-------|-------------|
| Webhook 處理器完善 | 🔴 高 | v1.1（補丁） |
| TagRule 執行邏輯 | 🟡 中 | v2.0 |
| 前端 UI/UX 優化 | 🟢 低 | 持續改進 |

### v2 規劃債務處理

- ✅ 住房記錄從 JSON 遷移到獨立表
- ✅ 訊息歸檔機制建立
- ✅ 配額管理完善

---

## 📚 相關文件

- [v1 實作決策記錄](./implementation_decisions.md)
- [v2 待辦事項清單](./todo.md)
- [資料庫設計規格](./erm.dbml)
- [LINE 訊息 API 規格](./api_line_message_interface.md)
- [功能規格](./features/)

---

## 變更記錄

| 日期 | 版本 | 變更內容 | 負責人 |
|------|------|---------|--------|
| 2025-11-20 | v1.1 | v1 完成度更新為 100%，新增 TagRule 不實作說明 | Claude |
| 2025-11-20 | v1.0 | 建立版本路線圖，規劃 v1/v2/v3 | Claude |

---

**最後更新**: 2025-11-20
**維護者**: Lili Hotel 開發團隊
